{
  "comments": [
    {
      "key": {
        "uuid": "db352f4c_a41ac8df",
        "filename": "redfish-core/lib/update_service.hpp",
        "patchSetId": 5
      },
      "lineNbr": 762,
      "author": {
        "id": 1000312
      },
      "writtenOn": "2020-05-20T16:12:51Z",
      "side": 1,
      "message": "Don\u0027t we need to handle Targets and Oem of UpdateParameters?",
      "revId": "bf5b9a6aca7f8f33dc0442527160d382738ece93",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "976cf75d_64bd8346",
        "filename": "redfish-core/lib/update_service.hpp",
        "patchSetId": 5
      },
      "lineNbr": 762,
      "author": {
        "id": 1000397
      },
      "writtenOn": "2020-05-21T03:48:14Z",
      "side": 1,
      "message": "For now, should only parse the applyTime property and update d-bus.\nright?",
      "parentUuid": "db352f4c_a41ac8df",
      "revId": "bf5b9a6aca7f8f33dc0442527160d382738ece93",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86969539_31d5e287",
        "filename": "redfish-core/lib/update_service.hpp",
        "patchSetId": 5
      },
      "lineNbr": 771,
      "author": {
        "id": 1000312
      },
      "writtenOn": "2020-05-20T16:12:51Z",
      "side": 1,
      "message": "have you tested the update with the uploaded image? Does the image binary received as same or any headers were added to it by multi-part?",
      "revId": "bf5b9a6aca7f8f33dc0442527160d382738ece93",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "60c9a9e2_38658bd3",
        "filename": "redfish-core/lib/update_service.hpp",
        "patchSetId": 5
      },
      "lineNbr": 771,
      "author": {
        "id": 1000397
      },
      "writtenOn": "2020-05-21T03:48:14Z",
      "side": 1,
      "message": "\u003ehave you tested the update with the uploaded image? \nyes, upload and update image success.\n\n\u003eby multi-part?\nsorry, according to the redfish spec, we need to use the octet-stream type to receive the image binary instead of multi-part.\nhttp://redfish.dmtf.org/schemas/DSP0266_1.8.0.html#multipart-http-push-updates-a-id-http-push-update-a-",
      "parentUuid": "86969539_31d5e287",
      "revId": "bf5b9a6aca7f8f33dc0442527160d382738ece93",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9ce1a076_9bf1e982",
        "filename": "redfish-core/lib/update_service.hpp",
        "patchSetId": 5
      },
      "lineNbr": 771,
      "author": {
        "id": 1000022
      },
      "writtenOn": "2020-05-21T10:48:09Z",
      "side": 1,
      "message": "I don\u0027t see the implementation is correct, as per the redfish spec, the request should have been like this.\n\nMultiPart request should have the boundary tag, You ccan see the implementation in following commit.\n\nhttps://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/31030\n\n\nPOST /redfish/v1/UpdateService/upload HTTP/1.1\nHost: \u003chost-path\u003e\nContent-Type: multipart/form-data; boundary\u003d---------------------------d74496d66958873e\nContent-Length: \u003ccomputed-length\u003e\nConnection: keep-alive\nX-Auth-Token: \u003csession-auth-token\u003e\n\n-----------------------------d74496d66958873e\nContent-Disposition: form-data; name\u003d\"UpdateParameters\"\nContent-Type: application/json\n\n{\n    \"Targets\": [\n        \"/redfish/v1/Managers/1\"\n    ],\n    \"@Redfish.OperationApplyTime\": \"OnReset\",\n    \"Oem\": {}\n}\n\n-----------------------------d74496d66958873e\nContent-Disposition: form-data; name\u003d\"UpdateFile\"; filename\u003d\"flash.bin\"\nContent-Type: application/octet-stream\n\n\u003csoftware image binary\u003e",
      "parentUuid": "60c9a9e2_38658bd3",
      "revId": "bf5b9a6aca7f8f33dc0442527160d382738ece93",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f0df18c0_15133e27",
        "filename": "redfish-core/lib/update_service.hpp",
        "patchSetId": 5
      },
      "lineNbr": 771,
      "author": {
        "id": 1000312
      },
      "writtenOn": "2020-05-21T15:04:46Z",
      "side": 1,
      "message": "I just used this patch and tried update using postman tool, the image file has got appended with 2 bytes at the end of the file. Can you also test with postman and check? I used postman as below.\n\n\nPOST https://10.190.164.182/redfish/v1/UpdateService/upload\nKEY\nUpdateParameters\nVALUE \n{\"Targets\":\"/redfish/v1/Managers/1\"],\"@Redfish.OperationApplyTime\":\"Immediate\",\"Oem\":{}}\nCONTENT TYPE\napplication/json\n\nKEY\nUpdateFile\nVALUE\nbmc_signed_cap-20200515120637.bin\nCONTENT TYPE\napplication/octet-stream",
      "parentUuid": "9ce1a076_9bf1e982",
      "revId": "bf5b9a6aca7f8f33dc0442527160d382738ece93",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ac847c58_cf376028",
        "filename": "redfish-core/lib/update_service.hpp",
        "patchSetId": 5
      },
      "lineNbr": 771,
      "author": {
        "id": 1000397
      },
      "writtenOn": "2020-05-22T01:40:19Z",
      "side": 1,
      "message": "@Vikram B\n\u003ebmc_signed_cap-20200515120637.bin\nIt should be *.tar, please see my commit message, thanks :)\n\n@Rata\n\u003eI don\u0027t see the implementation is correct\ncould you point out where is not correct? thanks.\nissues about this commit: https://github.com/ibm-openbmc/dev/issues/1372.\n\n\u003eMultiPart request should have the boundary tag\nright.\nI printed the following message from this commit.\n\nPOST /redfish/v1/UpdateService/upload HTTP/1.1\nHost: \u003chost-path\u003e\nContent-Type: multipart/form-data; boundary\u003d---------------------------91b83fcd225fffac\nContent-Length: \u003ccomputed-length\u003e\nConnection: keep-alive\nX-Auth-Token: \u003csession-auth-token\u003e\n\n-----------------------------91b83fcd225fffac\nContent-Disposition: form-data; name\u003d\"UpdateParameters\"\nContent-Type: application/json\n\n{\n    \"Targets\": [\n        \"/redfish/v1/Managers/1\"\n    ],\n    \"@Redfish.OperationApplyTime\": \"Immediate\",\n    \"Oem\": {}\n}\n\n-----------------------------91b83fcd225fffac\nContent-Disposition: form-data; name\u003d\"UpdateFile\"; filename\u003d\"obmc-phosphor-image-fp5280g2.static.mtd.tar\"\nContent-Type: application/octet-stream\n\n\u003csoftware image binary\u003e",
      "parentUuid": "f0df18c0_15133e27",
      "revId": "bf5b9a6aca7f8f33dc0442527160d382738ece93",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6af58b30_f78a2e5b",
        "filename": "redfish-core/lib/update_service.hpp",
        "patchSetId": 5
      },
      "lineNbr": 771,
      "author": {
        "id": 1000312
      },
      "writtenOn": "2020-05-27T11:14:26Z",
      "side": 1,
      "message": "@Liu, With HttpPushUri we could earlier use both .bin and .tar files on the binary POST body. This changing prompting for changes in the back end (i.e. phosphor-bmc-code-mgmt) where uploaded image is need to be parsed. We need to know why binary image upload is not working with form-data.",
      "parentUuid": "ac847c58_cf376028",
      "revId": "bf5b9a6aca7f8f33dc0442527160d382738ece93",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    }
  ]
}