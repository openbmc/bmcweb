{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "8ab05ff5_35c08adf",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1000331
      },
      "writtenOn": "2022-08-11T17:18:04Z",
      "side": 1,
      "message": "I think several sensor-providing applications already add a type suffix to the D-Bus sensor name.  It is used to differentiate the various sensors from a single device.\n\nFor example, the D-Bus sensor names from the phosphor-regulators app for voltage regulator \u0027vdd1\u0027 are:\n* vdd1_iout\n* vdd1_iout_peak\n* vdd1_iout_valley\n* vdd1_pout\n* vdd1_temperature\n* vdd1_temperature_peak\n* vdd1_vout\n* vdd1_vout_peak\n* vdd1_vout_valley\n\nI see similar D-Bus sensor names from other sensor-providing apps, such as:\n* ps0_temp0\n* Ambient_2_Temp\n\nSensor names had to be unique in the Redfish Sensors output and in the GUI.  There can also be several sensors that fall into the same D-Bus sensor category, such as 3 regulator sensors dealing with voltage.\n\nWith this change, the type will be in the Redfish sensor name/URI twice:\n* current_vdd1_iout\n* temperature_vdd1_temperature\n* voltage_vdd1_vout\n* temperature_Ambient_2_Temp\n\nThis seems like confusing change for end users.",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "930d2d08_70cbb58b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1000331
      },
      "writtenOn": "2022-08-11T17:24:14Z",
      "side": 1,
      "message": "Perhaps an alternative would be to use a pattern/regex to infer the D-Bus sensor category from the Redfish sensor name, such as .*[tT]emp.* -\u003e temperature, .*[vV]out* -\u003e voltage.  I don\u0027t know; that might lead to some false positives.  Just trying to think of an alternative.",
      "parentUuid": "8ab05ff5_35c08adf",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b851445_34e0d330",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1000331
      },
      "writtenOn": "2022-08-11T17:39:26Z",
      "side": 1,
      "message": "Another option would be to do a GetSubTreePaths call on \"/xyz/openbmc_project/sensors\".  That would be an extra D-Bus call unfortunately, but it should be a lot cheaper and more efficient than calling GetSubTree or GetManagedObjects.  You can then search through the returned list of just D-Bus object paths to find the full path to the specified sensor name and do a GetObject on that.",
      "parentUuid": "930d2d08_70cbb58b",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "74fc8c66_ee421a05",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1000020
      },
      "writtenOn": "2022-08-11T19:10:01Z",
      "side": 1,
      "message": "I don\u0027t like the sensor type in there twice either.\nE.g. \ntemperature_Ambient_2_Temp\ntemperature_vdd1_temperature\n\nI don\u0027t see any documentation in \nhttps://github.com/openbmc/phosphor-dbus-interfaces/blob/master/yaml/xyz/openbmc_project/Sensor/Value.interface.yaml\naround sensor naming, if we did go down this road, we need some. \nE.g. \"the sensor name should be lower case and not contain the sensor type\"?\n\nAs Shawn pointed out sensors had to be unique for Redfish Sensors output so why some contain the sensor type. :/",
      "parentUuid": "0b851445_34e0d330",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "58f7fe68_8b06cc54",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1000020
      },
      "writtenOn": "2022-08-11T19:18:35Z",
      "side": 1,
      "message": "D-Bus: /xyz/openbmc_project/sensors/temperature/\u003csensor\u003e\nRedfish: /redfish/v1/Chassis/\u003cchassis\u003e/Sensors/\u003csensor\u003e\n\nThere is information in the D-Bus path (e.g. this is a temperature sensor) that isn\u0027t in the Redfish path so including temperature in the sensor name makes sense but this is a big change and needs to be documented, should not just be a bmcweb change.",
      "parentUuid": "74fc8c66_ee421a05",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ea6e41ba_dee84e21",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1000331
      },
      "writtenOn": "2022-08-11T19:19:24Z",
      "side": 1,
      "message": "Another complication, as I noted above, is that some devices provide multiple sensors that fall into a category.  A single voltage regulator may provide two temperature-oriented sensor values, 3 voltage values, 3 current values, etc.  So the sensor object path cannot be as simple as sensors/temperature/vdd1.",
      "parentUuid": "74fc8c66_ee421a05",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "02d745f2_c529c523",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-08-11T19:19:26Z",
      "side": 1,
      "message": "\u003e This seems like confusing change for end users.\n\nThe URI isn\u0027t for end users.  Users should be relying on \"Name\", which through this patch remains the same, and user facing.  Also, in terms of it being confusing, the \"vdd\" portion comes from the naming convention in the per-machine config files, so users that are confused are free to pick less confusing names (given that the dbus path is already namespaced).  This just makes redfish expose more of the confusing dbus.\n\nFor the regex stuff, that scares me a little trying to keep that both correct and up to date with every possible naming convention, especially when users are free to pick their own.  If folks are using the URI ID for anything human facing in a non debug context, that\u0027s a bug in their implementation.\n\n\u003e   You can then search through the returned list of just D-Bus object paths to find the full path to the specified sensor name and do a GetObject on that.\n\nThis is almost exactly what the old code did and the reason it was very slow, because it had to pull hundreds of sensors just to find the one it was looking for.",
      "parentUuid": "74fc8c66_ee421a05",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b0f49f10_1157f9b0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-08-11T19:22:46Z",
      "side": 1,
      "message": "\u003e around sensor naming, if we did go down this road, we need some. \n\nI\u0027m not quite following why this would be required.  The sensor \"Name\" isn\u0027t changing in this patch, only the URI and the associated \"Id\" both of which are under the direction of the Redfish implementation.  The fact that the URI even includes the name at all is an implementation detail, which we could debatably just base64 encode per the spec, but that seems unnecessarily pedantic for debug use cases.",
      "parentUuid": "02d745f2_c529c523",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5e717843_b9747d65",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1000020
      },
      "writtenOn": "2022-08-11T19:54:12Z",
      "side": 1,
      "message": "I need to more clear with Name and Id and which Name (D-bus or Redfish) I am referring too. Tried to be more clear here. \n\nRedfish IDs can\u0027t be assumed in Redfish (e.g. the path could be /redfish/v1/Chassis/\u003cchassis\u003e/Sensors/1) and Redfish gives other fields to identify a sensor (unfortunately most of those other fields aren\u0027t implemented) and Redfish name is set to the Redfish Id currently.\n\nWith this change it looks like Redfish Id would be temperature_Ambient_2_Temp for an example sensor from above. \nAnd Redfish Name continue to be Ambient_2_Temp, which the GUI would use Name on the Table. I still think we need some rules in https://github.com/openbmc/phosphor-dbus-interfaces/blob/master/yaml/xyz/openbmc_project/Sensor/Value.interface.yaml around D-Bus sensor names. Should the D-Bus sensor name contain the sensor type or not? If it doesn\u0027t then Redfish Name should probably also be temperature_my_sensor.",
      "parentUuid": "b0f49f10_1157f9b0",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bfc71d43_c9a521c4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 30,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-08-11T20:38:07Z",
      "side": 1,
      "message": "\u003e Should the D-Bus sensor name contain the sensor type or not? \n\nI don\u0027t think we can specify this, as doing it would immediately break a bunch of systems, and one big use case for OpenBMC is \"I want my naming to exactly match my old stack\" which is why the name fields are free-form in the platform config.\n\nEarly in dbus-sensors, we shopped around the idea of \"lets just lock down all the sensor names on a consistent algorithm\" and that flew like a lead balloon.  Folks have strong opinions on naming that I don\u0027t think it\u0027s worth it as a community to try to solve.\n\n\n\u003e if it doesn\u0027t then Redfish Name should probably also be temperature_my_sensor.\n\nI wouldn\u0027t be an advocate for that, because we (the bmcweb maintainers) are messing with a users intent if we change the \"Name\" property from what they gave us.  If a user wants their sensor to be called \"Temperature at the north pole\" they should be allowed to do that, otherwise we\u0027ll end up on santas naughty list.  In a more real case, if a user wanted a name in a totally different language, they could.",
      "parentUuid": "5e717843_b9747d65",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8a16fd8b_58c54f44",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 47,
      "author": {
        "id": 1000682
      },
      "writtenOn": "2022-08-10T17:26:58Z",
      "side": 1,
      "message": "I thought you said we should use the same code path for $expand and per item get.",
      "range": {
        "startLine": 43,
        "startChar": 0,
        "endLine": 47,
        "endChar": 7
      },
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "79ed71f1_7a00fc16",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 47,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-08-10T22:12:52Z",
      "side": 1,
      "message": "I’m not sure I understand the question.  yes, in theory we could use the generic GetAll handler for the expand queries, but given your recent optimizations, I think they will result in more dbus calls, so I left the existing code.  In theory we could test if those performance increases are still needed, but I think it’d be better to push that to a later patch, given that this patch works fine and is an improvement for the non expand case.",
      "parentUuid": "8a16fd8b_58c54f44",
      "range": {
        "startLine": 43,
        "startChar": 0,
        "endLine": 47,
        "endChar": 7
      },
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96d14793_c77e2116",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 47,
      "author": {
        "id": 1000682
      },
      "writtenOn": "2022-08-10T22:19:47Z",
      "side": 1,
      "message": "The question is that, during the code review of memory expand codes, I went with GetAll for single item, GetManagedObjects for expand, you made a comment saying we should use the same code. So later I used GetManagedObjects for both case.\n\nNow in this patch, you are changing sensor to the previous option.\n\nThis is inconsistent. So I was asking for an explanation: what\u0027s the right direction and why is that?",
      "parentUuid": "79ed71f1_7a00fc16",
      "range": {
        "startLine": 43,
        "startChar": 0,
        "endLine": 47,
        "endChar": 7
      },
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f195bed6_99db2585",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 47,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-08-11T04:26:23Z",
      "side": 1,
      "message": "I don\u0027t recall that specific conversation, but it\u0027s possible that I misspoke, intended a difference or was plain wrong.  With that said, there\u0027s a few things that differentiate sensors from inventory.\n\n1. There\u0027s realistically only 2 sensor producers, so it\u0027s a lot easier to make assumptions about what each implements compared to inventory, which has 10s of daemons implementing, not all upstream.  ObjectManager is a requirement in the sensor schema, it is not in the inventory schemas (well, until recently).\n2. This patchset does use the same code for all the parsing routines.  There is almost no duplication in the construction of the json object for sensor versus not.  The only primary additive difference is the code to actually do the GetAll call.\n3. This common code is used to construct 3 different schemas (Sensors, Power, Thermal), so in comparison to inventory, which has lots of code with very little reuse between daemons, as well as many more redfish routes to service in the long run (maybe 12 different inventory schemas?), duplication in sensor code doesn\u0027t lead to a large difference in binary size.",
      "parentUuid": "96d14793_c77e2116",
      "range": {
        "startLine": 43,
        "startChar": 0,
        "endLine": 47,
        "endChar": 7
      },
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b52659c_f629e1cd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 47,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-08-11T04:31:42Z",
      "side": 1,
      "message": "Once we\u0027ve made the prerequisite patches required for your Memory efficiency patch, lets take a look at it again and like I said before, it\u0027s quite possible I made a mistake about the amount of duplication between the inventory schemas.",
      "parentUuid": "f195bed6_99db2585",
      "range": {
        "startLine": 43,
        "startChar": 0,
        "endLine": 47,
        "endChar": 7
      },
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81481afe_c01d998c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 62,
      "author": {
        "id": 1000020
      },
      "writtenOn": "2022-08-11T20:09:03Z",
      "side": 1,
      "message": "Do you need any telemetry changes here? Can that be quick part of the test?\n\nE.g.  \n\n/redfish/v1/TelemetryService/MetricDefinitions/Altitude\n{\n\"@odata.id\": \"/redfish/v1/TelemetryService/MetricDefinitions/Altitude\",\n\"@odata.type\": \"#MetricDefinition.v1_0_3.MetricDefinition\",\n\"Id\": \"Altitude\",\n\"IsLinear\": true,\n\"MetricDataType\": \"Decimal\",\n\"MetricProperties\": [\n\"/redfish/v1/Chassis/chassis/Sensors/Altitude/Reading\"\n],\n\"MetricType\": \"Numeric\",\n\"Name\": \"Altitude\",\n\"Units\": \"m\"\n}",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e26017f6_25af7879",
        "filename": "/COMMIT_MSG",
        "patchSetId": 5
      },
      "lineNbr": 62,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-08-12T18:48:31Z",
      "side": 1,
      "message": "That\u0027s a really good point, I forgot they pulled this file in.  In the ideal case, some of this file needs broken out into \"sensor utils\" outside the lib folder so that it\u0027s more clear which parts are common between handlers, and which parts are independent.\n\n@krzysztof is there a good set of tests for Telemetry, or some use cases you can recommend?  I\u0027m not very familiar with the TelemetryService stuff, but Gunnar is totally right, I need to do some testing there (and it\u0027s quite possible this patch breaks telemetry service).\n\nI will take a look at this async and try to tease out what changes if any need made there.",
      "parentUuid": "81481afe_c01d998c",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2787e972_de9512a4",
        "filename": "redfish-core/lib/sensors.hpp",
        "patchSetId": 5
      },
      "lineNbr": 3020,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-08-10T02:47:36Z",
      "side": 1,
      "message": "Note to the reviewers, we can\u0027t use sdbusplus::message::object_path here, because sensors have different escaping rules.",
      "revId": "848a4346187f043a96e223902d41341214966541",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}