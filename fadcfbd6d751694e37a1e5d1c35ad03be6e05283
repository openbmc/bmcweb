{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "2b1ddd55_f8b61340",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000073
      },
      "writtenOn": "2024-11-18T09:53:59Z",
      "side": 1,
      "message": "I have verified this patch,\nModifying gateway with single IP address works.\nI see error while adding new ip with different gateway on the same interfaces\nI\u0027m getting 401 unauthorised and loosing connection.\n\ncurl -k -H \"X-Auth-Token:${bmc_token}\" -H \"Content-Type: application/json\" -X PATCH -D patch.txt -d \u0027{\"IPv4StaticAddresses\":[{},{\"Address\":\"10.9.9.95\",\"SubnetMask\": \"255.255.255.0\",\"Gateway\":\"10.9.9.1\"}]}\u0027 https://${bmc}/redfish/v1/Managers/bmc/EthernetInterfaces/eth0",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "32f33926_b27aed1d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-11-18T16:35:13Z",
      "side": 1,
      "message": "If you\u0027re sending [{}.... \n\nyou must\u0027ve already loaded a static IP?  Can you give the full set of commands you ran from a factory reset BMC?\n\nI\u0027m really surprised to see 401..... There\u0027s only a few calls to that and none of them in the networking code.  If you get me a set of curl commands to reproduce I can try them.",
      "parentUuid": "2b1ddd55_f8b61340",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96813a32_432579ca",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000350
      },
      "writtenOn": "2024-11-18T16:39:48Z",
      "side": 1,
      "message": "1. Configured one static IP \n2. Add 2nd IP with different gateway on same interface, looks like bmcweb crashed.",
      "parentUuid": "32f33926_b27aed1d",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "176cec89_e7cbf4f5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-11-18T18:24:33Z",
      "side": 1,
      "message": "I think I found the issue.  Can you retest with the latest?",
      "parentUuid": "96813a32_432579ca",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bba19594_83198d85",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000073
      },
      "writtenOn": "2024-11-19T09:19:55Z",
      "side": 1,
      "message": "Tested the scenarios:\n1. Modifying Gateway - Worked\n\n2. On adding new IP with same gateway getting 400 bad request but IP is getting added with old gateway\ncurl -k -H \"X-Auth-Token: $bmc_token\" -H \"Content-Type: application/json\" -X PATCH -D patch.txt -d \u0027{\"IPv4StaticAddresses\":[{},{\"Address\": \"9.3.29.125\",\"SubnetMask\": \"255.255.255.0\",\"Gateway\":\"9.3.29.1\"}]}\u0027 https://$bmc/redfish/v1/Managers/bmc/EthernetInterfaces/eth0\n\n3. On adding new IP with different gateway getting 400 bad request but IP is getting added with old gateway\ncurl -k -H \"X-Auth-Token:${bmc_token}\" -H \"Content-Type: application/json\" -X PATCH -D patch.txt -d \u0027{\"IPv4StaticAddresses\":[{},{\"Address\":\"10.9.9.95\",\"SubnetMask\": \"255.255.255.0\",\"Gateway\":\"10.9.9.1\"}]}\u0027 https://${bmc}/redfish/v1/Managers/bmc/EthernetInterfaces/eth0\n\n4. On adding two IP addresses and deleting one IP seeing that Gateway is getting deleted.\ncurl -k -H \"X-Auth-Token: $bmc_token\" -H \"Content-Type: application/json\"  -X PATCH -D patch.txt -d \u0027{\"IPv4StaticAddresses\":[null]}\u0027 https://$bmc/redfish/v1/Managers/bmc/EthernetInterfaces/eth0",
      "parentUuid": "176cec89_e7cbf4f5",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "21340592_33d29fb2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000073
      },
      "writtenOn": "2024-11-19T09:28:18Z",
      "side": 1,
      "message": "Getting the error:\n\ncurl -k -H \"X-Auth-Token:${bmc_token}\" -H \"Content-Type: application/json\" -X PATCH -D patch.txt -d \u0027{\"IPv4StaticAddresses\":[{},{\"Address\":\"10.9.9.95\",\"SubnetMask\": \"255.255.255.0\",\"Gateway\":\"10.9.9.1\"}]}\u0027 https://${bmc}/redfish/v1/Managers/bmc/EthernetInterfaces/eth0 \n{\n  \"error\": {\n    \"@Message.ExtendedInfo\": [\n      {\n        \"@odata.type\": \"#Message.v1_1_1.Message\",\n        \"Message\": \"The property \u0027IPv4StaticAddresses/2/Gateway\u0027 could not be written because its value would conflict with the value of the \u0027IPv4StaticAddresses/1/Gateway\u0027 property.\",\n        \"MessageArgs\": [\n          \"IPv4StaticAddresses/2/Gateway\",\n          \"IPv4StaticAddresses/1/Gateway\"\n        ],\n        \"MessageId\": \"Base.1.19.0.PropertyValueConflict\",\n        \"MessageSeverity\": \"Warning\",\n        \"Resolution\": \"None.\"\n      }\n    ],\n    \"code\": \"Base.1.19.0.PropertyValueConflict\",\n    \"message\": \"The property \u0027IPv4StaticAddresses/2/Gateway\u0027 could not be written because its value would conflict with the value of the \u0027IPv4StaticAddresses/1/Gateway\u0027 property.\"\n  }",
      "parentUuid": "bba19594_83198d85",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eb900e63_ff37a56b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000278
      },
      "writtenOn": "2024-11-19T20:41:01Z",
      "side": 1,
      "message": "I am trying the same on my own machine ATM.\nPATCH :url/redfish/v1/Managers/bmc/EthernetInterfaces/eth1\nContent-Type: application/json\n{\n     \"IPv4StaticAddresses\": [\n     {\n             \"Address\": \"192.168.20.11\",\n             \"SubnetMask\": \"255.255.255.0\",\n             \"Gateway\": \"192.168.20.1\"\n     }\n     ]\n}\n\nI can send this repeatedly, and it will accept it.\nI can take away the address, and subnetmask, and it still works as expected.\n\nTake this with a grain of salt, however.\nIntel is substantially behind the most recent bmcweb state.\nSHA: 6d0b80be1b79122de60ade0b80460510696954e0\nThis is over 130 commits behind the origin.\nThis particular PATCH command is part of a series I used to test the Gateway handling in the first place. I was surprised when this commit came in, as I was certain I had confirmed the correct behavior.",
      "parentUuid": "21340592_33d29fb2",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "127a6544_f2092b74",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-11-19T21:14:14Z",
      "side": 1,
      "message": "I need to talk with you more about it, but I wanted to start from something more than \"i\u0027m seeing a bug\".\n\nI don\u0027t really care whether or not this merges, but so far as I can test, we\u0027re broken.\n\nI would\u0027ve expected that:\n\n\"IPv4StaticAddresses\": [\n{\n\"Gateway\": \"192.168.20.1\"\n}\n\nWould return a conflict if you tested on master, but I haven\u0027t had a change to dig super deep on this yet.  I just wanted to post something as a starting point to see if others were seeing the same conflict.",
      "parentUuid": "eb900e63_ff37a56b",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "89640b3f_d122bf31",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000278
      },
      "writtenOn": "2024-11-19T21:33:17Z",
      "side": 1,
      "message": "I was just going to see about trying to bisect this. The problem is we have so many patches. There are build artifacts elsewhere that depend on them. I\u0027m not sure if I can be successful.",
      "parentUuid": "127a6544_f2092b74",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24ee928d_481e841d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-11-19T21:34:24Z",
      "side": 1,
      "message": "I appreciate the help, and honestly if the answer is that this patch is wrong and needs to die in a fire, that\u0027s fine.",
      "parentUuid": "89640b3f_d122bf31",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "55294967_ca908647",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000278
      },
      "writtenOn": "2024-11-20T19:15:22Z",
      "side": 1,
      "message": "I\u0027ve performed a devtool checkout of bmcweb, and switched to SHA d109e2b60f7bb367dc8115475c6cb86bca6e1914 Refactor: move registries functions to their file\n\nI am unable to duplicate the issue as stated.\nMy process (all via Redfish):\nDisable DHCPv4 on eth1\nAssign a single static IPv4 address, netmask, gateway. (x.x.x.11)\nIssue the same request\nIssue a request with only the Gateway in the PATCH\nIssue a request to add two IPv4 addresses\n   - The PATCH has the original assignment  (x.x.x.11)\n   - The PATCH adds a second assignment (x.x.x.30)\nDelete one static IPv4\nRun the DELETE action a second time, clearing all static IPv4\nRe-enable DHCPv4\n\nAll requests complete with a \"204 No Content\" response code.\n\nThere\u0027s something different in how we\u0027re activating the code, and I\u0027d like to understand the variance. IMO it shouldn\u0027t matter what the NIC happens to be, NCSI vs USB.",
      "parentUuid": "24ee928d_481e841d",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7eee1e6_4a8ca3b8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-11-22T16:07:18Z",
      "side": 1,
      "message": "\u003e Disable DHCPv4 on eth1\n\nThis is probably the difference.  I leave DHCP enabled, so this hits different paths.",
      "parentUuid": "55294967_ca908647",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "919129d1_37b388ff",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 23,
      "author": {
        "id": 1000278
      },
      "writtenOn": "2024-11-22T16:45:41Z",
      "side": 1,
      "message": "Which is in error?\nphosphor-network explicitly blocks adding a gateway when dhcpv4 is active.\n            if (!dhcp4())\n            {\n                auto gateway4 \u003d EthernetInterfaceIntf::defaultGateway();\n                if (!gateway4.empty())\nSo your https://gerrit.openbmc.org/c/openbmc/phosphor-networkd/+/75860 commit is explicitly bypassing that check.\n\nWhat is the correct behavior in this instance?\nWhile systemd doesn\u0027t block DHCPv4 and static V4 simultaneously, it is counter to the dominant paradigm.\nIMO, if DHCPv4 is active, any PATCH of the StaticIPV4Addresses is violating common practice, and by extension needs to be blocked.\nI tested the change creating two static IPv4 addresses on the same NIC. Again, systemd doesn\u0027t prevent this. At the same time I\u0027m not sure what value doing this has for something like a BMC.",
      "parentUuid": "a7eee1e6_4a8ca3b8",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6e26cbb8_8eecae35",
        "filename": "redfish-core/lib/ethernet.hpp",
        "patchSetId": 3
      },
      "lineNbr": 1506,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-11-18T18:23:36Z",
      "side": 1,
      "message": "This is the bug.  We iterate twice.",
      "revId": "fadcfbd6d751694e37a1e5d1c35ad03be6e05283",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}