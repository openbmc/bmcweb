{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "92482a1a_b1e902e2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 17
      },
      "lineNbr": 22,
      "author": {
        "id": 1001252
      },
      "writtenOn": "2022-05-06T02:01:12Z",
      "side": 1,
      "message": "I would personally prefer keeping the satellite configuration in a user writable place like bmcweb_persistent_data.json as entity-manager json may not be writable at runtime. This might be implemented in future.\n\nCurrent implementation looks good to me.",
      "range": {
        "startLine": 19,
        "startChar": 0,
        "endLine": 22,
        "endChar": 53
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f74cef68_8e7607cb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 17
      },
      "lineNbr": 22,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T17:59:41Z",
      "side": 1,
      "message": "\u003e I would personally prefer keeping the satellite configuration in a user writable place like bmcweb_persistent_data.json\n\nnope.  bmcweb_persistent_data.json is not meant to be user writable, and does not change per platform.  By design it should be able to be erased entirely and bmcweb should still largely function.\n\n\u003e as entity-manager json may not be writable at runtime.\n\nI\u0027m not quite following this statement.  If entity-manager isn\u0027t available, then there\u0027s no way to know about possible entities that support redfish, and therefore this feature would essentially not be useful, so I\u0027m not following the above statement.\n\n\u003e This might be implemented in future.\n\u003e \n\u003e Current implementation looks good to me.",
      "parentUuid": "92482a1a_b1e902e2",
      "range": {
        "startLine": 19,
        "startChar": 0,
        "endLine": 22,
        "endChar": 53
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "303297a2_ee0753ff",
        "filename": "/COMMIT_MSG",
        "patchSetId": 17
      },
      "lineNbr": 22,
      "author": {
        "id": 1001252
      },
      "writtenOn": "2022-05-17T08:54:28Z",
      "side": 1,
      "message": "I\u0027ve not made it clear in my comments. The redfish spec allows the aggregation source being changed at runtime. As far as I know, entity-manager does not support updating the content of system.json at runtime. Some values of the config, like the hostname/IP, need to be user-editable in real use cases.\n\nMy opinion of using bmcweb_persistent_data.json is because eventservice also saves its configuration there. There might be some better ways to store the redfish aggregation config.",
      "parentUuid": "f74cef68_8e7607cb",
      "range": {
        "startLine": 19,
        "startChar": 0,
        "endLine": 22,
        "endChar": 53
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8dd63c28_84012fc1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 17
      },
      "lineNbr": 22,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-17T16:56:04Z",
      "side": 1,
      "message": "\u003e I\u0027ve not made it clear in my comments. The redfish spec allows the aggregation source being changed at runtime. As far as I know, entity-manager does not support updating the content of system.json at runtime.\n\nIt does support that, both via probe statements, and via direct manipulation of the parameters via SetProperty.\n\n\u003e Some values of the config, like the hostname/IP, need to be user-editable in real use cases.\n\nWe should talk through what that really means;  I suspect the parameters themselves aren\u0027t really changeable, but a user might want to add another aggregation source.\n\n\u003e \n\u003e My opinion of using bmcweb_persistent_data.json is because eventservice also saves its configuration there.\n\nThat is a different use case, because EventService has no dependence on what hardware is in the system, so bmcweb can keep that as an internal detail.\n\n\u003e There might be some better ways to store the redfish aggregation config.\n\nI suspect if we ever support truly runtime, user driven aggregation configs, we\u0027ll likely need the data in two places, given that entity-manager has to be hardware backed, and bmcweb is explicitly not hardware backed.  We\u0027ll duplicate a little parsing code, which isn\u0027t great, but the lifecycles will at least be correct.",
      "parentUuid": "303297a2_ee0753ff",
      "range": {
        "startLine": 19,
        "startChar": 0,
        "endLine": 22,
        "endChar": 53
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a7135e00_f5d7d61d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 17
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T18:08:49Z",
      "side": 1,
      "message": "A few minor things, then this patchset shoudl be good to go.",
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d104c95e_acf9429a",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 15,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T18:08:49Z",
      "side": 1,
      "message": "Pretty sure you don\u0027t need this, certainly not with the incorrect date and company.  In general we\u0027ve been removing these, as they really do nothing legally (the license is bound in the root of the repo).",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 15,
        "endChar": 2
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f79e6699_f3ec9f41",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 15,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-10T22:20:11Z",
      "side": 1,
      "message": "I gotcha, it\u0027s been removed.",
      "parentUuid": "d104c95e_acf9429a",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 15,
        "endChar": 2
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "401cf0d2_dfc8d164",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 32,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T18:08:49Z",
      "side": 1,
      "message": "As written, this is essentially a cache, which in general we try to discourage, especially in the initial patchset of a feature, given that caches are very hard to invalidate properly, and the bmc memory is limited.   this patchset doesn\u0027t seem to invalidate this config at all.  Lets avoid this cache for the moment and just generate the list on the fly when we get a request;\n\nI\u0027m not totally against caching in this case, but I\u0027d like to see it done in a separate patch so we can compare/contrast the tradeoffs in complexity and performance.",
      "range": {
        "startLine": 32,
        "startChar": 0,
        "endLine": 32,
        "endChar": 68
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c97b37e6_79b477dc",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 32,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-10T22:20:11Z",
      "side": 1,
      "message": "I understand, but I would still like to try to make the argument for including the map in this patch.\n\n1) The memory hit for this should be minor since it is only storing a boost::urls::url per satellite and the number of satellites would presumably remain small.  \n\n2) Satellite information has to be published on D-Bus in order to be added to the map. That info should only exist when the intent is to use Redfish Aggregation so you won\u0027t see the same memory increase in BMCs that are not using Redfish Aggregation.\n\n3) A D-Bus lookup will be added to the processing of every single request by BMCWeb since it will have no other way to check if Redfish Aggregation is enabled.\n\n4) For invalidation concerns, what if each time getSatelliteConfigs() is called I clear the map as the first step?  That functions already pulls all existing satellite configs from D-Bus so that would remove the ones that are no longer present.  \n\n5) The next patch (https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/53455) adds a D-Bus match so that will catch when satellite info is added or changed.",
      "parentUuid": "401cf0d2_dfc8d164",
      "range": {
        "startLine": 32,
        "startChar": 0,
        "endLine": 32,
        "endChar": 68
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0c1d745_4c535ea5",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 32,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-11T16:32:01Z",
      "side": 1,
      "message": "1. \"small number of satellites\" is not guaranteed.  As this patch is written, I can instantiate 3 million satellite controllers, and therefore cause safety concerns.\n\n2. This is the same argument for basically any dbus property, and in the past the argument has been made that we don\u0027t want to take global init-memory hits for things that we don\u0027t use, and even if we did, we would want to manage it globally for all dbus objects.  In practice, the existing dbus mechanisms have been fast enough that there wasn\u0027t a lot of reason to take on the complexities of a cache, and in the cases we\u0027ve done that, we\u0027ve end up reverting it (search for UserCache in the history) because it\u0027s non-trivial to cache dbus resources.\n\n3. Yep.  \"check dbus for every request\" is how basically every handler in bmcweb works today.  Doing it this way at first is more of a mechanism for proving the need for the complexity of a cache, and keeping this patchset small, rather than being a permanent thing.\n\n\n4/5. That question is better answered in another patch;  What you suggested probably needs some match expressions to add/remove elements as we\u0027ve done elsewhere, but that code is non-trivial.\n\n\n\n\nTo be clear, I\u0027m not saying we don\u0027t need to do this in the end, but in terms of incremental progress, and keeping the patches additive, I\u0027d like to start with a synchronous version first, because we have a lot of experience with that pattern, and that way, when we add that cache, we can say \"in real use cases, this makes requests X% faster\" so that the complexity is justified, or, if we hit similar cases like we have in the past, where adding the cache only added \u003c2% performance improvement, we\u0027ve saved the complexity.",
      "parentUuid": "c97b37e6_79b477dc",
      "range": {
        "startLine": 32,
        "startChar": 0,
        "endLine": 32,
        "endChar": 68
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "44972a73_0f441309",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 32,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-11T18:13:17Z",
      "side": 1,
      "message": "Understood, thank you for indulging me haha and no I didn\u0027t think you were arguing against ever doing it.  I\u0027ll make the changes to enable repeated lookups in future patches.\n\nAs part of this I might remove the patch I mentioned which is adding a D-Bus signal match (https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/53455) from this patch chain.  I don\u0027t think it\u0027ll have much use unless satellite config caching is added.  I\u0027ll leave that discussion though to its own patch.",
      "parentUuid": "f0c1d745_4c535ea5",
      "range": {
        "startLine": 32,
        "startChar": 0,
        "endLine": 32,
        "endChar": 68
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5bae6484_6014755c",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 32,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-11T22:38:12Z",
      "side": 1,
      "message": "I\u0027ve made changes so that each time getSatelliteConfigs() is called it queries the D-Bus and creates an unordered_map of all satellite configs.  \n\nIt now takes as an argument a handler function which itself expects the map of satellite configs as an argument.  Later patches will use this handler to interact with the satellite config information in order to perform Redfish Aggregation operations.",
      "parentUuid": "44972a73_0f441309",
      "range": {
        "startLine": 32,
        "startChar": 0,
        "endLine": 32,
        "endChar": 68
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2eecbf32_4096fabc",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 32,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-12T16:13:54Z",
      "side": 1,
      "message": "üëç",
      "parentUuid": "5bae6484_6014755c",
      "range": {
        "startLine": 32,
        "startChar": 0,
        "endLine": 32,
        "endChar": 68
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3c511b8_cc2c79e0",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 64,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T18:08:49Z",
      "side": 1,
      "message": "nit, this-\u003e is redundant.",
      "range": {
        "startLine": 64,
        "startChar": 28,
        "endLine": 64,
        "endChar": 32
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aa424cf6_9a3d77a2",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 64,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-10T22:20:11Z",
      "side": 1,
      "message": "Thanks, I removed it.",
      "parentUuid": "b3c511b8_cc2c79e0",
      "range": {
        "startLine": 64,
        "startChar": 28,
        "endLine": 64,
        "endChar": 32
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "da847d82_640ca7fd",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 79,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T18:08:49Z",
      "side": 1,
      "message": "Can you break this content into its own method please?  as a rule we try to avoid large lambdas, and this isn\u0027t super big, but it\u0027s right on the limit.",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 79,
        "endChar": 17
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0494d72d_dbd38641",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 79,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-10T22:20:11Z",
      "side": 1,
      "message": "No problem, it\u0027s been moved.",
      "parentUuid": "da847d82_640ca7fd",
      "range": {
        "startLine": 54,
        "startChar": 0,
        "endLine": 79,
        "endChar": 17
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "63c84ab0_dc9aafa0",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 195,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T18:08:49Z",
      "side": 1,
      "message": "What if there are two satellite controllers with the same name?  It would be good if we could at least print a message here, instead of silently overwriting the second one.",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 34
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5c2d2f09_2af255da",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 195,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T18:08:49Z",
      "side": 1,
      "message": "nit, use std::move(url) here.",
      "range": {
        "startLine": 195,
        "startChar": 30,
        "endLine": 195,
        "endChar": 33
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c3571227_a97f797e",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 195,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-10T22:20:11Z",
      "side": 1,
      "message": "I modified the insertion so that now the debug message will denote when an existing config has been updated",
      "parentUuid": "63c84ab0_dc9aafa0",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 34
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "777afd32_268818d5",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 195,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-10T22:20:11Z",
      "side": 1,
      "message": "I made the change",
      "parentUuid": "5c2d2f09_2af255da",
      "range": {
        "startLine": 195,
        "startChar": 30,
        "endLine": 195,
        "endChar": 33
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0039ce95_93c43d1c",
        "filename": "redfish-core/include/redfish_aggregator.hpp",
        "patchSetId": 17
      },
      "lineNbr": 195,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-11T16:32:01Z",
      "side": 1,
      "message": "üëç",
      "parentUuid": "c3571227_a97f797e",
      "range": {
        "startLine": 195,
        "startChar": 8,
        "endLine": 195,
        "endChar": 34
      },
      "revId": "7f1294feda9ba6f341619e9c83182de8b9fbcc22",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}