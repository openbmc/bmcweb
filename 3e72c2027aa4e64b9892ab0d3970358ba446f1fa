{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "34aa337e_6cb9a4b3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-06-25T08:08:13Z",
      "side": 1,
      "message": "Hello,\n\nI understand I\u0027m late to the party but probably someone can still clarify please.\n\nHow is this supposed to be used with remotely authenticated users, e.g. with LDAP?\n```\n# busctl call xyz.openbmc_project.User.Manager /xyz/openbmc_project/user xyz.openbmc_project.User.Manager GetUserInfo s ldap_sync\na{sv} 2 \"RemoteUser\" b true \"UserPrivilege\" s \"priv-admin\"\n```\nAs you can see `UserGroups` array isn\u0027t present in the reply at all in this case. This leads to a regression where previously LDAP/RADIUS/whatever-authenticated users could use SOL and now they can not (even worse, the web interface terminates the session on attempt as it gets 401 reply trying to upgrade connection to WS).\n\nAlso, why is host serial console access permission treated in a way that differs from IP KVM access? Aren\u0027t implications about the same in most scenarios? Is there a document somewhere describing the rationale behind this change?",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b3b2a09_07a633aa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-06-25T16:11:17Z",
      "side": 1,
      "message": "I\u0027ve been under the impression that LDAP is essentially not usable in its current form.  The fact that this has been checked in for over a year and nobody has reported LDAP issues somewhat backs that up.\n\nI would assume that this is just a bug in phosphor-user-manager that needs fixed.\n\n\u003e Also, why is host serial console access permission treated in a way that differs from IP KVM access?\n\nBecause people want to treat them differently, and Redfish treats them separately.\u0027\n\n\u003e Aren\u0027t implications about the same in most scenarios?\n\npossibly.  There might be cases where the serial console is more locked down than KVM (or vice versa) so some admins might give access to one or the other.  It\u0027s probably also something to do with \"Principal of least privilege\".",
      "parentUuid": "34aa337e_6cb9a4b3",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e3d12252_3c10eb77",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-06-25T16:51:26Z",
      "side": 1,
      "message": "\u003e I\u0027ve been under the impression that LDAP is essentially not usable in its current form.  The fact that this has been checked in for over a year and nobody has reported LDAP issues somewhat backs that up.\n\nWell, I\u0027m reporting it now. Can say after that minimal fix to webui (to assume Administrator for remote users) it\u0027s quite usable without tricks or tweaks.\n\n\u003e I would assume that this is just a bug in phosphor-user-manager that needs fixed.\n\nAFAICT the LDAP support was designed under assumption that every user has just a primary group assigned and that primary group is mapped to Administrator/Operator/ReadOnly and that\u0027s it. It used to work nicely enough and it still can work but this patch I\u0027m commenting introduced a regression.\n\nRequiring extending not only phosphor-user-manager, bmcweb and webui-vue (for adding `GroupsAttribute`) to implement support for multiple groups but also probably the LDAP schema and actual database (at the clients\u0027!) looks like something that breaks compatibiliity with existing installs way too much.\n \n\u003e \u003e Also, why is host serial console access permission treated in a way that differs from IP KVM access?\n\u003e \n\u003e Because people want to treat them differently, and Redfish treats them separately.\u0027\n\u003e \n\u003e \u003e Aren\u0027t implications about the same in most scenarios?\n\u003e \n\u003e possibly.  There might be cases where the serial console is more locked down than KVM (or vice versa) so some admins might give access to one or the other.  It\u0027s probably also something to do with \"Principal of least privilege\".\n\nThen those people can please share their document called \"Threat Model\" so one could verify whether the implementation helps anything at all. Current way of requiring additional local group to access serial console (and not requiring anything like that for KVM so any Administrator can use it) is likely to not limit potential attacker anyhow as many modern popular setups (e.g. RHEL or Windows Server) do not even enable any control over serial by default but provide full control over KVM.\n\nSo far it looks like the gain is really dubious security-wise while regression is real...",
      "parentUuid": "0b3b2a09_07a633aa",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5aea02a7_872ea98f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-06-25T17:37:50Z",
      "side": 1,
      "message": "\u003e Well, I\u0027m reporting it now.\n\nYep, that\u0027s fine.  LDAP support goes more to the fact that to my knowledge there\u0027s no way to test it, no instructions on how to set it up, or documentation for others to execute.  That\u0027s fine you\u0027re reporting it;  If your goal is to fix the bug, no need to comment here, just send the patch to fix it.  If your goal is to keep LDAP working in the long term, we either need some way to test it (think a simple script to run or something), or to have someone testing it manually periodically.\n\n\n\u003e looks like something that breaks compatibiliity with existing installs way too much.\n\nWhat does \"installs\" mean in this context?  We have an API, so far as I understand the API backward compatibility support has been maintained.\n\n\u003e Requiring extending not only phosphor-user-manager, bmcweb and webui-vue\n\nphosphor-user-manager support was already added as part of this.  webui-vue support isn\u0027t required (the default is that new users get access to everything I believe).\n\nI could certainly see the argument that this should be a 403 forbidden (because the login was valid), not a 401 unauthorized.  That\u0027s something we could pretty trivially fix.  I actually don\u0027t even see where we\u0027re sending 401 from for serial websockets, so I\u0027ll need you to propose that change if you have ldap set up and can see where it\u0027s setting 401.\n\n\n\u003e Then those people can please share their document called \"Threat Model\"\n\nI said nothing about threat model, so I\u0027m not sure why you made that leap or why it would be required in this case.  https://en.wikipedia.org/wiki/Principle_of_least_privilege is what I was referring to, and involves those that don\u0027t need access to a serial console should not have access to it, regardless of whether or not it changes the threat model.\n\n\u003e RHEL or Windows Server\n\nI would say the majority of OpenBMC installs aren\u0027t running either of these, so I\u0027m not sure where the comparison comes from.  At the end of the day, someone thought it was a useful enough feature for them that they went to a lot of effort to do it and upstream it.  The feature might not be useful to you, which is fine, but that\u0027s a different discussion.\n\n\n\n\nAll of this feedback it great, but you haven\u0027t really stated what you\u0027d like to see happen here.",
      "parentUuid": "e3d12252_3c10eb77",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "11b1e18e_1982d4d3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-06-25T17:41:32Z",
      "side": 1,
      "message": "\u003e even worse, the web interface terminates the session on attempt as it gets 401 reply \n\nI just looked, and I\u0027m not sure how this could happen in the code.  I would expect a 403 forbidden from here:\n\nhttps://github.com/openbmc/bmcweb/blob/0bdda665a3589924e1f5a51d7ff8633c6544ffa1/include/dbus_privileges.hpp#L94\n\nPresumably that\u0027s not what you\u0027re seeing.",
      "parentUuid": "5aea02a7_872ea98f",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "54dedfb1_a20bd55e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-06-25T20:11:51Z",
      "side": 1,
      "message": "\u003e \u003e looks like something that breaks compatibiliity with existing installs way too much.\n\u003e\n\u003e What does \"installs\" mean in this context? We have an API, so far as I understand the API backward compatibility support has been maintained.\n\nThis patch seems to be written under assumption that a single user can belong to several groups (which is normal for POSIX systems). Compare these two cases:\n```\n# busctl call xyz.openbmc_project.User.Manager /xyz/openbmc_project/user xyz.openbmc_project.User.Manager GetUserInfo s root\na{sv} 6 \"RemoteUser\" b false \"UserEnabled\" b true \"UserGroups\" as 5 \"hostconsole\" \"ipmi\" \"redfish\" \"ssh\" \"web\" \"UserLockedForFailedAttempt\" b false \"UserPasswordExpired\" b false \"UserPrivilege\" s \"priv-admin\"\n```\nand\n```\n# busctl call xyz.openbmc_project.User.Manager /xyz/openbmc_project/user xyz.openbmc_project.User.Manager GetUserInfo s ldap_sync\na{sv} 2 \"RemoteUser\" b true \"UserPrivilege\" s \"priv-admin\"\n```\n\nfor remote users `phosphor-user-manager` doesn\u0027t even report the list of `UserGroups` as it has no facilities to obtain that. And even if it did, that would require changes to the database serving the user data. That\u0027s what I mean by existing installs, the LDAP databases customers already have in production, plus existing working BMC configuration.\n\nSo with this new code the old LDAP configuration can not allow SOL anymore. Unless we fake `UserGroups` for `priv-admin` and the rest. Is that what you suggest?\n\n\u003e \u003e RHEL or Windows Server\n\u003e\n\u003e I would say the majority of OpenBMC installs aren\u0027t running either of these, so I\u0027m not sure where the comparison comes from\n\nHm, I thought those are the most popular operating systems running on server machines these days. What\u0027s the majority then, ESXi? But that seems unlikely since OpenBMC was feeding it IPMI sensor names it couldn\u0027t understand for many years and nobody complained. Is ESXi offering more control over serial than KVM by default? So what the majority of OpenBMC installs are running on host CPUs?\n\n\u003e All of this feedback it great, but you haven\u0027t really stated what you\u0027d like to see happen here.\n\nHah, guess not so great if my point is still not clear, sorry about that, not sure how we have this impedance mismatch again and again.\n\nI\u0027d like Ninad Palsule, who was behind this code creation and submission (or anyone else who knows what the deal is about), to provide clear rationale and explanation for this feature so that the regression could be fixed in a meaningful way without regressing their feature or compromising their goals. But for that we need to understand their goals first. In your earlier comment you said \"I\u0027m not sure what the point is of this patch then, which I thought was to be able to dish out host console access separate from user role, but at least this retains the current behavior.\" so it looks like the intent behind this patch is not so clear and needs clarifications.\n\nI\u0027d like to see the way forward with fixing the regression with remotely authenticated users. Be it by reverting this patch or by fixing phosphor-user-manager (I do not see a practical way other than faking groups for remote users) or other ideas that do not cross my mind. I think whomever introduced the regression should be at least trying to help with that. I referred to them by \"those people\" when I asked for the threat model they\u0027re working with (not you, it\u0027s not you who introduced and advocated this functionality).\n\n\u003e \u003e even worse, the web interface terminates the session on attempt as it gets 401 reply \n\u003e \n\u003e I just looked, and I\u0027m not sure how this could happen in the code.  I would expect a 403 forbidden from here:\n\u003e \n\u003e https://github.com/openbmc/bmcweb/blob/0bdda665a3589924e1f5a51d7ff8633c6544ffa1/include/dbus_privileges.hpp#L94\n\u003e \n\u003e Presumably that\u0027s not what you\u0027re seeing.\n\nIndeed, I\u0027m not seeing exactly that. With a version few months old I was getting 401 as an unfortunate combination of bmcweb segfaulting (presumably due to some lifetime object issues) trying to make a reply to the request of Upgrading to websocket when user is not allowed to that and answering 401 after restarting on some other query. But since it\u0027s not current HEAD that\u0027s not relevant much.\n\nCurrent version shows me `NS_ERROR_NET_RESET` when Firefox tries to `GET wss://172.41.1.250/console/default` on behalf of an LDAP user mapped to Administrator. Which is kind of OK (better than 401) but still is a regression.",
      "parentUuid": "11b1e18e_1982d4d3",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8a6185c0_de031f1e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-06-25T20:31:34Z",
      "side": 1,
      "message": "This closed code review is not the appropriate forum for this discussion.  Clearly there\u0027s a lot of things that need to be discussed concerning LDAP, but a comment on a closed gerrit review won\u0027t get a lot of reviewers, nor does it include everyone that needs included (webui/user-manager maintainers namely).  I do recall this did have a design doc previously, so you might look at that as well before you start the discussion.\n\nI know you have strong opinions on which forums you like to use, so I\u0027ll leave it up to you where to continue this conversation.",
      "parentUuid": "54dedfb1_a20bd55e",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ce5e63d3_943c8261",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1001634
      },
      "writtenOn": "2024-06-28T19:50:33Z",
      "side": 1,
      "message": "Paul, Sorry I just saw it. Did you get chance to look at the documentation changes for this drop\" https://gerrit.openbmc.org/c/openbmc/docs/+/60968/6/architecture/user-management.md",
      "parentUuid": "8a6185c0_de031f1e",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3d20863_8d84515f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-06-28T20:27:17Z",
      "side": 1,
      "message": "\u003e Paul, Sorry I just saw it. Did you get chance to look at the documentation changes for this drop\" https://gerrit.openbmc.org/c/openbmc/docs/+/60968/6/architecture/user-management.md\n\nHello Ninad, thank you for getting back to me with this. No, I wasn\u0027t aware of that change to the docs but looking at it now I\u0027m afraid I only see \"what\" but not \"why\" there. What is the threat model here and how this change helps with it? Also it says that Webconsole users can authenticate against LDAP but I do not see how it\u0027s supposed to be possible given the current implementation.\n\nIf you do not mind please let us continue this discussion on the mailing list so that other interested parties would be aware and could participate: https://lore.kernel.org/openbmc/CACWQX80B7o9Dn611OOVDS4ViV9BOjn_x_Lwh62em+0-6q3g4Kw@mail.gmail.com/T/#t .\n\nBasically, my question is why exactly you think this is a good idea (especially why serial console needs a separate group while IP KVM doesn\u0027t). And how this can be used with remote authentication (e.g. LDAP) when we are limited to a single (\"primary\") group in the current setups and code across the whole stack. Also I see you added a migration script which covers the local users nicely (by adding all admins to \"hostconsole\" local group) but it regresses SOL access both via WebUI and ssh -p 2200 for remotely authenticated users.\n\nI hope we can find a good way forward but your help here is needed to clarify your usecases and requirements.",
      "parentUuid": "ce5e63d3_943c8261",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9c0634bc_3a7a6dc4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000020
      },
      "writtenOn": "2024-07-03T20:22:42Z",
      "side": 1,
      "message": "\u003e  looking at it now I\u0027m afraid I only see \"what\" but not \"why\" there\n\nThis hostconsole user group was added to control access to the Host Console. It maps to Redfish\u0027s AccountType \u003d HostConsole\n\n\u003e (especially why serial console needs a separate group while IP KVM doesn\u0027t). \n\nI think the driving factor behind this was adding the AccountType \u003d HostConsole\nhttps://gerrit.openbmc.org/q/topic:%22hostconsole-group%22\n\nRedfish does have a separate group for KVMIP, so we can discuss if we want to create a new user group for that. \n\n            \"enumDescriptions\": {\n                \"HostConsole\": \"Allow access to the host\u0027s console, which could be connected through Telnet, SSH, or another protocol.\",\n                \"IPMI\": \"Allow access to the Intelligent Platform Management Interface service.\",\n                \"KVMIP\": \"Allow access to a Keyboard-Video-Mouse over IP session.\",\n                \"ManagerConsole\": \"Allow access to the manager\u0027s console, which could be connected through Telnet, SSH, SM CLP, or another protocol.\",\n                \"OEM\": \"OEM account type.  See the `OEMAccountTypes` property.\",\n                \"Redfish\": \"Allow access to the Redfish service.\",\n                \"SNMP\": \"Allow access to SNMP services.\",\n                \"VirtualMedia\": \"Allow access to control virtual media.\",\n                \"WebUI\": \"Allow access to a web user interface session, such as a graphical interface or another web-based protocol.\"\n            },",
      "parentUuid": "c3d20863_8d84515f",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2af443ba_35bd2f14",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-07-04T00:02:24Z",
      "side": 1,
      "message": "\u003e \u003e  looking at it now I\u0027m afraid I only see \"what\" but not \"why\" there\n\u003e \n\u003e This hostconsole user group was added to control access to the Host Console. It maps to Redfish\u0027s AccountType \u003d HostConsole\n\nSo when does it actually help? Is it useful in real life at all for anything?\n\nWhy is it not better to revert this (and the change to dropbear port 2200 config) to fix regression with remote authentication? What would be the possible alternatives for fixing this regression?",
      "parentUuid": "9c0634bc_3a7a6dc4",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "62a35617_31ae044e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-07-04T00:11:08Z",
      "side": 1,
      "message": "\u003e \u003e \u003e  looking at it now I\u0027m afraid I only see \"what\" but not \"why\" there\n\u003e \u003e \n\u003e \u003e This hostconsole user group was added to control access to the Host Console. It maps to Redfish\u0027s AccountType \u003d HostConsole\n\u003e \n\u003e So when does it actually help? Is it useful in real life at all for anything?\n\nyes,  if you want to disable the host console access to a user.  not all systems have kvm.\n\n\n\u003e \n\u003e Why is it not better to revert this (and the change to dropbear port 2200 confi to fix regression with remote authentication? What would be the possible alternatives for fixing this regression?\n\n\nwith respect, I don’t really think revert is an option.  LDAP isn’t really used, as proven by the fact that this was broken over a year ago and this is the first report.  I’ve seen many reports that LDAP doesn’t work at all, and to my knowledge there’s no documentation or setup scripts to test functionality.\n\nmy recommendation would be to find the bug in phosphor user manager that doesn’t expose the right groups, and just fix it.\n\nfwiw, this might be a case where dmtf might need to be engaged, because I don’t know how one would configure “this user has host console access” in the existing LDAP configs.",
      "parentUuid": "2af443ba_35bd2f14",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "04a863b7_b1312f8f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-07-04T00:38:53Z",
      "side": 1,
      "message": "\u003e \u003e \u003e \u003e  looking at it now I\u0027m afraid I only see \"what\" but not \"why\" there\n\u003e \u003e \u003e \n\u003e \u003e \u003e This hostconsole user group was added to control access to the Host Console. It maps to Redfish\u0027s AccountType \u003d HostConsole\n\u003e \u003e \n\u003e \u003e So when does it actually help? Is it useful in real life at all for anything?\n\u003e \n\u003e yes,  if you want to disable the host console access to a user.  not all systems have kvm.\n\nThat seems to be such a niche usecase. Having no KVM but having serial console and wanting BMC user with Administrator rights not being able to access serial console of the host... Why can\u0027t someone share a non-hypothetical example of this?..\n\n\u003e \u003e Why is it not better to revert this (and the change to dropbear port 2200 confi to fix regression with remote authentication? What would be the possible alternatives for fixing this regression?\n\u003e \n\u003e \n\u003e with respect, I don’t really think revert is an option.  LDAP isn’t really used, as proven by the fact that this was broken over a year ago and this is the first report.\n\nNot all OpenBMC downstreams follow upstream closely enough, unfortunately.\n\nFor how many years did OpenBMC not include separate hostconsole group and how many people complained about it? In fact, did anyone complain at all ever before Ninad decided to introduce this?\n\n\u003e I’ve seen many reports that LDAP doesn’t work at all, and to my knowledge there’s no documentation or setup scripts to test functionality.\n\nFunctionality of using Microsoft Active Directory is hard to test with a script... Also there\u0027s nothing special about it other than assigning BMC users \"legacy primary POSIX group\" about this setup from AD side, like any windows sysadmin should be able to assist with testing that if one wanted.\n\nAs to testing against e.g. OpenLDAP, that can probably be made with a script, yes, but, again, it\u0027s faster to just ask a sysadmin to setup one rather than invest in writing such a script I think.\n\nI personally tested both, not many surprises there...\n\n\u003e my recommendation would be to find the bug in phosphor user manager that doesn’t expose the right groups, and just fix it.\n\nWhat if there\u0027s no bug at all? It was never meant to provide a _list_ of groups. Just one single primary group. That\u0027s how the code was designed and written. There\u0027s no even good generic way to do that especially for nested groups (you have to do a recursive search over them; Microsoft AD provides a non-standard extension for the purpose).\n\n\u003e fwiw, this might be a case where dmtf might need to be engaged, because I don’t know how one would configure “this user has host console access” in the existing LDAP configs.\n\nFor local users Ninad provided a migration script so this change at least didn\u0027t regress that. So it looks like you\u0027re not supposed to introduce a change which would break existing configs, it should have an automatic migration path, right? But there\u0027s no way for automatic migration for LDAP config as it\u0027s not managed by BMC. So this change is wrong, it breaks valid and working usecase.",
      "parentUuid": "62a35617_31ae044e",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9333bb37_aecd176c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-07-04T01:07:19Z",
      "side": 1,
      "message": "Actionable suggestion: I write a script that configures OpenLDAP in a GNU/Linux distro of your choice and sends an OpenBMC host (specific QEMU target of your choice) some Redfish requests to make it use that server for authenticating users. If that works you revert hostconsole patches (so that SOL both over WebSocket and over ssh works for an LDAP user mapped to Administrator).\n\nDeal?",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a65cf7ca_6336965f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-07-04T15:31:30Z",
      "side": 1,
      "message": "\u003e \u003e \u003e \u003e \u003e  looking at it now I\u0027m afraid I only see \"what\" but not \"why\" there\n\u003e \u003e \u003e \u003e \n\u003e \u003e \u003e \u003e This hostconsole user group was added to control access to the Host Console. It maps to Redfish\u0027s AccountType \u003d HostConsole\n\u003e \u003e \u003e \n\u003e \u003e \u003e So when does it actually help? Is it useful in real life at all for anything?\n\u003e \u003e \n\u003e \u003e yes,  if you want to disable the host console access to a user.  not all systems have kvm.\n\u003e \n\u003e That seems to be such a niche usecase. Having no KVM but having serial console and wanting BMC user with Administrator rights not being able to access serial console of the host... Why can\u0027t someone share a non-hypothetical example of this?..\n\nthis has nothing to do with administrator or any role.  that’s why it’s separate.\nthe ability to control whether a user has access to the serial console is a feature a lot of BMCs support.\n\n\n\u003e \n\u003e \u003e \u003e Why is it not better to revert this (and the change to dropbear port 2200 confi to fix regression with remote authentication? What would be the possible alternatives for fixing this regression?\n\u003e \u003e \n\u003e \u003e \n\u003e \u003e with respect, I don’t really think revert is an option.  LDAP isn’t really used, as proven by the fact that this was broken over a year ago and this is the first report.\n\u003e \n\u003e Not all OpenBMC downstreams follow upstream closely enough, unfortunately.\n\u003e \n\u003e For how many years did OpenBMC not include separate hostconsole group and how many people complained about it? In fact, did anyone complain at all ever before Ninad decided to introduce this?\n\nthe lack of ability to limit users access was brought up by more than just Ninad, and in my (maintainer) opinion is a reasonable feature to have.\n\n\u003e \n\u003e \u003e I’ve seen many reports that LDAP doesn’t work at all, and to my knowledge there’s no documentation or setup scripts to test functionality.\n\u003e \n\u003e Functionality of using Microsoft Active Directory is hard to test with a script... Also there\u0027s nothing special about it other than assigning BMC users \"legacy primary POSIX group\" about this setup from AD side, like any windows sysadmin should be able to assist with testing that if one wanted.\n\ncool; can’t wait for you to document how easy it is.  as someone with pretty good Redfish knowledge, it was more effort than I was willing to put forth to learn how to do.\n\n\u003e \n\u003e As to testing against e.g. OpenLDAP, that can probably be made with a script, yes, but, again, it\u0027s faster to just ask a sysadmin to setup one rather than invest in writing such a script I think.\n\nthat kind of thinking is why features break.  if committers can’t test for regressions easily, we have to rely on it just breaking, then folks like yourself fixing it.\n\n\u003e \n\u003e I personally tested both, not many surprises there...\n\u003e \n\u003e \u003e my recommendation would be to find the bug in phosphor user manager that doesn’t expose the right groups, and just fix it.\n\u003e \n\u003e What if there\u0027s no bug at all? It was never meant to provide a _list_ of groups.\n\nphosphor-user-manager absolutely provides a list of groups in its interfaces today.\n\n\u003e Just one single primary group. That\u0027s how the code was designed and written. There\u0027s no even good generic way to do that especially for nested groups (you have to do a recursive search over them; Microsoft AD provides a non-standard extension for the purpose).\n\u003e \n\u003e \u003e fwiw, this might be a case where dmtf might need to be engaged, because I don’t know how one would configure “this user has host console access” in the existing LDAP configs.\n\u003e \n\u003e For local users Ninad provided a migration script so this change at least didn\u0027t regress that. So it looks like you\u0027re not supposed to introduce a change which would break existing configs, it should have an automatic migration path, right? But there\u0027s no way for automatic migration for LDAP config as it\u0027s not managed by BMC. So this change is wrong, it breaks valid and working usecase.\n\n\nyep, and reverting this will also break existing users, so we need to find a solution that doesn’t impact either types of users.",
      "parentUuid": "04a863b7_b1312f8f",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "da53b2a3_a0a51bfb",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-07-04T15:31:30Z",
      "side": 1,
      "message": "I would like to see the script written, but that doesn’t mean I’m going to break host console users to do it.\n\nI’ve seen almost no discussion about how both of these features could exist together in the same codebase, so I suspect that’s the next step before we start talking about reverting anything.",
      "parentUuid": "9333bb37_aecd176c",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b2518210_e2df0291",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-07-04T16:56:17Z",
      "side": 1,
      "message": "\u003e I would like to see the script written, but that doesn’t mean I’m going to break host console users to do it.\n\nSo first I\u0027m supposed to write a script, then I\u0027m supposed to contact DMTF forum to gather opinions, then I\u0027m supposed to get feedback from phosphor-user-manager maintainers who do not seem to be willing to respond at all and then might be one year later we come to a consensus of how to fix this without regressing those hypothetical hostconsole users?\n\nDoesn\u0027t sound like a fair deal to me. Easier to patch it out downstream, and it won\u0027t be even painful for rebases.\n\nSo be it, I\u0027ll just concentrate on something where I can make a difference and where I see some sense. I\u0027m ready to advocate and provide real life scenarios for each and every line of code I propose, and when I see I\u0027m wrong I admit that. (Good) software exists to serve a purpose, not to tick a box in the feature set. When I offer a change I have a clear idea of how it should be making an end-user\u0027s life easier or happier and I can share it in plain text when needed. In the rare cases I can not I\u0027m ready to admit it might be a nonsense goal.",
      "parentUuid": "da53b2a3_a0a51bfb",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ab74370a_fd73e851",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-07-04T16:56:17Z",
      "side": 1,
      "message": "\u003e \u003e \u003e \u003e \u003e \u003e  looking at it now I\u0027m afraid I only see \"what\" but not \"why\" there\n\u003e \u003e \u003e \u003e \u003e \n\u003e \u003e \u003e \u003e \u003e This hostconsole user group was added to control access to the Host Console. It maps to Redfish\u0027s AccountType \u003d HostConsole\n\u003e \u003e \u003e \u003e \n\u003e \u003e \u003e \u003e So when does it actually help? Is it useful in real life at all for anything?\n\u003e \u003e \u003e \n\u003e \u003e \u003e yes,  if you want to disable the host console access to a user.  not all systems have kvm.\n\u003e \u003e \n\u003e \u003e That seems to be such a niche usecase. Having no KVM but having serial console and wanting BMC user with Administrator rights not being able to access serial console of the host... Why can\u0027t someone share a non-hypothetical example of this?..\n\u003e \n\u003e this has nothing to do with administrator or any role.  that’s why it’s separate.\n\u003e the ability to control whether a user has access to the serial console is a feature a lot of BMCs support.\n\nI\u0027m asking you (or anybody else) to share https://en.wikipedia.org/wiki/User_story where this feature is needed in real life.\n\n\u003e \u003e Functionality of using Microsoft Active Directory is hard to test with a script... Also there\u0027s nothing special about it other than assigning BMC users \"legacy primary POSIX group\" about this setup from AD side, like any windows sysadmin should be able to assist with testing that if one wanted.\n\u003e \n\u003e cool; can’t wait for you to document how easy it is.  as someone with pretty good Redfish knowledge, it was more effort than I was willing to put forth to learn how to do.\n\nCan\u0027t wait to see at least one non-imaginary user of hostconsole feature.\n\nI\u0027m ready to write an LDAP user story.\n \n\u003e \u003e As to testing against e.g. OpenLDAP, that can probably be made with a script, yes, but, again, it\u0027s faster to just ask a sysadmin to setup one rather than invest in writing such a script I think.\n\u003e \n\u003e that kind of thinking is why features break.  if committers can’t test for regressions easily, we have to rely on it just breaking, then folks like yourself fixing it.\n\nI agree it would be useful to have.\n\n\u003e \u003e \u003e my recommendation would be to find the bug in phosphor user manager that doesn’t expose the right groups, and just fix it.\n\u003e \u003e \n\u003e \u003e What if there\u0027s no bug at all? It was never meant to provide a _list_ of groups.\n\u003e \n\u003e phosphor-user-manager absolutely provides a list of groups in its interfaces today.\n\nNOT FOR REMOTE USERS, it can NOT do that for remote users and it\u0027s not a bug, it was designed like that.\n\n\u003e \u003e For local users Ninad provided a migration script so this change at least didn\u0027t regress that. So it looks like you\u0027re not supposed to introduce a change which would break existing configs, it should have an automatic migration path, right? But there\u0027s no way for automatic migration for LDAP config as it\u0027s not managed by BMC. So this change is wrong, it breaks valid and working usecase.\n\u003e \n\u003e yep, and reverting this will also break existing users, so we need to find a solution that doesn’t impact either types of users.\n\nI\u0027m not convinced those users exist. If Redfish has some feature it doesn\u0027t mean anyone\u0027s using it. If that feature is really useful I can\u0027t for the life of me understand why nobody is willing to share the user stories and threat models that motivated its introduction into OpenBMC.",
      "parentUuid": "a65cf7ca_6336965f",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}