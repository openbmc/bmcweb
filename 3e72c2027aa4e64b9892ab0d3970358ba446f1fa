{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "34aa337e_6cb9a4b3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-06-25T08:08:13Z",
      "side": 1,
      "message": "Hello,\n\nI understand I\u0027m late to the party but probably someone can still clarify please.\n\nHow is this supposed to be used with remotely authenticated users, e.g. with LDAP?\n```\n# busctl call xyz.openbmc_project.User.Manager /xyz/openbmc_project/user xyz.openbmc_project.User.Manager GetUserInfo s ldap_sync\na{sv} 2 \"RemoteUser\" b true \"UserPrivilege\" s \"priv-admin\"\n```\nAs you can see `UserGroups` array isn\u0027t present in the reply at all in this case. This leads to a regression where previously LDAP/RADIUS/whatever-authenticated users could use SOL and now they can not (even worse, the web interface terminates the session on attempt as it gets 401 reply trying to upgrade connection to WS).\n\nAlso, why is host serial console access permission treated in a way that differs from IP KVM access? Aren\u0027t implications about the same in most scenarios? Is there a document somewhere describing the rationale behind this change?",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b3b2a09_07a633aa",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-06-25T16:11:17Z",
      "side": 1,
      "message": "I\u0027ve been under the impression that LDAP is essentially not usable in its current form.  The fact that this has been checked in for over a year and nobody has reported LDAP issues somewhat backs that up.\n\nI would assume that this is just a bug in phosphor-user-manager that needs fixed.\n\n\u003e Also, why is host serial console access permission treated in a way that differs from IP KVM access?\n\nBecause people want to treat them differently, and Redfish treats them separately.\u0027\n\n\u003e Aren\u0027t implications about the same in most scenarios?\n\npossibly.  There might be cases where the serial console is more locked down than KVM (or vice versa) so some admins might give access to one or the other.  It\u0027s probably also something to do with \"Principal of least privilege\".",
      "parentUuid": "34aa337e_6cb9a4b3",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e3d12252_3c10eb77",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-06-25T16:51:26Z",
      "side": 1,
      "message": "\u003e I\u0027ve been under the impression that LDAP is essentially not usable in its current form.  The fact that this has been checked in for over a year and nobody has reported LDAP issues somewhat backs that up.\n\nWell, I\u0027m reporting it now. Can say after that minimal fix to webui (to assume Administrator for remote users) it\u0027s quite usable without tricks or tweaks.\n\n\u003e I would assume that this is just a bug in phosphor-user-manager that needs fixed.\n\nAFAICT the LDAP support was designed under assumption that every user has just a primary group assigned and that primary group is mapped to Administrator/Operator/ReadOnly and that\u0027s it. It used to work nicely enough and it still can work but this patch I\u0027m commenting introduced a regression.\n\nRequiring extending not only phosphor-user-manager, bmcweb and webui-vue (for adding `GroupsAttribute`) to implement support for multiple groups but also probably the LDAP schema and actual database (at the clients\u0027!) looks like something that breaks compatibiliity with existing installs way too much.\n \n\u003e \u003e Also, why is host serial console access permission treated in a way that differs from IP KVM access?\n\u003e \n\u003e Because people want to treat them differently, and Redfish treats them separately.\u0027\n\u003e \n\u003e \u003e Aren\u0027t implications about the same in most scenarios?\n\u003e \n\u003e possibly.  There might be cases where the serial console is more locked down than KVM (or vice versa) so some admins might give access to one or the other.  It\u0027s probably also something to do with \"Principal of least privilege\".\n\nThen those people can please share their document called \"Threat Model\" so one could verify whether the implementation helps anything at all. Current way of requiring additional local group to access serial console (and not requiring anything like that for KVM so any Administrator can use it) is likely to not limit potential attacker anyhow as many modern popular setups (e.g. RHEL or Windows Server) do not even enable any control over serial by default but provide full control over KVM.\n\nSo far it looks like the gain is really dubious security-wise while regression is real...",
      "parentUuid": "0b3b2a09_07a633aa",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5aea02a7_872ea98f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-06-25T17:37:50Z",
      "side": 1,
      "message": "\u003e Well, I\u0027m reporting it now.\n\nYep, that\u0027s fine.  LDAP support goes more to the fact that to my knowledge there\u0027s no way to test it, no instructions on how to set it up, or documentation for others to execute.  That\u0027s fine you\u0027re reporting it;  If your goal is to fix the bug, no need to comment here, just send the patch to fix it.  If your goal is to keep LDAP working in the long term, we either need some way to test it (think a simple script to run or something), or to have someone testing it manually periodically.\n\n\n\u003e looks like something that breaks compatibiliity with existing installs way too much.\n\nWhat does \"installs\" mean in this context?  We have an API, so far as I understand the API backward compatibility support has been maintained.\n\n\u003e Requiring extending not only phosphor-user-manager, bmcweb and webui-vue\n\nphosphor-user-manager support was already added as part of this.  webui-vue support isn\u0027t required (the default is that new users get access to everything I believe).\n\nI could certainly see the argument that this should be a 403 forbidden (because the login was valid), not a 401 unauthorized.  That\u0027s something we could pretty trivially fix.  I actually don\u0027t even see where we\u0027re sending 401 from for serial websockets, so I\u0027ll need you to propose that change if you have ldap set up and can see where it\u0027s setting 401.\n\n\n\u003e Then those people can please share their document called \"Threat Model\"\n\nI said nothing about threat model, so I\u0027m not sure why you made that leap or why it would be required in this case.  https://en.wikipedia.org/wiki/Principle_of_least_privilege is what I was referring to, and involves those that don\u0027t need access to a serial console should not have access to it, regardless of whether or not it changes the threat model.\n\n\u003e RHEL or Windows Server\n\nI would say the majority of OpenBMC installs aren\u0027t running either of these, so I\u0027m not sure where the comparison comes from.  At the end of the day, someone thought it was a useful enough feature for them that they went to a lot of effort to do it and upstream it.  The feature might not be useful to you, which is fine, but that\u0027s a different discussion.\n\n\n\n\nAll of this feedback it great, but you haven\u0027t really stated what you\u0027d like to see happen here.",
      "parentUuid": "e3d12252_3c10eb77",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "11b1e18e_1982d4d3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-06-25T17:41:32Z",
      "side": 1,
      "message": "\u003e even worse, the web interface terminates the session on attempt as it gets 401 reply \n\nI just looked, and I\u0027m not sure how this could happen in the code.  I would expect a 403 forbidden from here:\n\nhttps://github.com/openbmc/bmcweb/blob/0bdda665a3589924e1f5a51d7ff8633c6544ffa1/include/dbus_privileges.hpp#L94\n\nPresumably that\u0027s not what you\u0027re seeing.",
      "parentUuid": "5aea02a7_872ea98f",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "54dedfb1_a20bd55e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 33
      },
      "lineNbr": 0,
      "author": {
        "id": 1000936
      },
      "writtenOn": "2024-06-25T20:11:51Z",
      "side": 1,
      "message": "\u003e \u003e looks like something that breaks compatibiliity with existing installs way too much.\n\u003e\n\u003e What does \"installs\" mean in this context? We have an API, so far as I understand the API backward compatibility support has been maintained.\n\nThis patch seems to be written under assumption that a single user can belong to several groups (which is normal for POSIX systems). Compare these two cases:\n```\n# busctl call xyz.openbmc_project.User.Manager /xyz/openbmc_project/user xyz.openbmc_project.User.Manager GetUserInfo s root\na{sv} 6 \"RemoteUser\" b false \"UserEnabled\" b true \"UserGroups\" as 5 \"hostconsole\" \"ipmi\" \"redfish\" \"ssh\" \"web\" \"UserLockedForFailedAttempt\" b false \"UserPasswordExpired\" b false \"UserPrivilege\" s \"priv-admin\"\n```\nand\n```\n# busctl call xyz.openbmc_project.User.Manager /xyz/openbmc_project/user xyz.openbmc_project.User.Manager GetUserInfo s ldap_sync\na{sv} 2 \"RemoteUser\" b true \"UserPrivilege\" s \"priv-admin\"\n```\n\nfor remote users `phosphor-user-manager` doesn\u0027t even report the list of `UserGroups` as it has no facilities to obtain that. And even if it did, that would require changes to the database serving the user data. That\u0027s what I mean by existing installs, the LDAP databases customers already have in production, plus existing working BMC configuration.\n\nSo with this new code the old LDAP configuration can not allow SOL anymore. Unless we fake `UserGroups` for `priv-admin` and the rest. Is that what you suggest?\n\n\u003e \u003e RHEL or Windows Server\n\u003e\n\u003e I would say the majority of OpenBMC installs aren\u0027t running either of these, so I\u0027m not sure where the comparison comes from\n\nHm, I thought those are the most popular operating systems running on server machines these days. What\u0027s the majority then, ESXi? But that seems unlikely since OpenBMC was feeding it IPMI sensor names it couldn\u0027t understand for many years and nobody complained. Is ESXi offering more control over serial than KVM by default? So what the majority of OpenBMC installs are running on host CPUs?\n\n\u003e All of this feedback it great, but you haven\u0027t really stated what you\u0027d like to see happen here.\n\nHah, guess not so great if my point is still not clear, sorry about that, not sure how we have this impedance mismatch again and again.\n\nI\u0027d like Ninad Palsule, who was behind this code creation and submission (or anyone else who knows what the deal is about), to provide clear rationale and explanation for this feature so that the regression could be fixed in a meaningful way without regressing their feature or compromising their goals. But for that we need to understand their goals first. In your earlier comment you said \"I\u0027m not sure what the point is of this patch then, which I thought was to be able to dish out host console access separate from user role, but at least this retains the current behavior.\" so it looks like the intent behind this patch is not so clear and needs clarifications.\n\nI\u0027d like to see the way forward with fixing the regression with remotely authenticated users. Be it by reverting this patch or by fixing phosphor-user-manager (I do not see a practical way other than faking groups for remote users) or other ideas that do not cross my mind. I think whomever introduced the regression should be at least trying to help with that. I referred to them by \"those people\" when I asked for the threat model they\u0027re working with (not you, it\u0027s not you who introduced and advocated this functionality).\n\n\u003e \u003e even worse, the web interface terminates the session on attempt as it gets 401 reply \n\u003e \n\u003e I just looked, and I\u0027m not sure how this could happen in the code.  I would expect a 403 forbidden from here:\n\u003e \n\u003e https://github.com/openbmc/bmcweb/blob/0bdda665a3589924e1f5a51d7ff8633c6544ffa1/include/dbus_privileges.hpp#L94\n\u003e \n\u003e Presumably that\u0027s not what you\u0027re seeing.\n\nIndeed, I\u0027m not seeing exactly that. With a version few months old I was getting 401 as an unfortunate combination of bmcweb segfaulting (presumably due to some lifetime object issues) trying to make a reply to the request of Upgrading to websocket when user is not allowed to that and answering 401 after restarting on some other query. But since it\u0027s not current HEAD that\u0027s not relevant much.\n\nCurrent version shows me `NS_ERROR_NET_RESET` when Firefox tries to `GET wss://172.41.1.250/console/default` on behalf of an LDAP user mapped to Administrator. Which is kind of OK (better than 401) but still is a regression.",
      "parentUuid": "11b1e18e_1982d4d3",
      "revId": "3e72c2027aa4e64b9892ab0d3970358ba446f1fa",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}