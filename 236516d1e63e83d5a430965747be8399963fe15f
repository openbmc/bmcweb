{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5676030e_4ad2a607",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 12
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-04-30T18:05:58Z",
      "side": 1,
      "message": "Looking pretty good.",
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "931cebff_f37a6606",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 579,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-04-30T18:05:58Z",
      "side": 1,
      "message": "We need to have a little discussion about separation of concerns here.  Right now we\u0027re just packing everything into the HttpClient class, which doesn\u0027t seem appropriate, and is making this patchset really hard to review.\n\nIMO (and yes, this is opinion, I\u0027m happy to have my mind changed) we need:\n\n1. A class for the generalized idea of an \"Http request sender\" that encapsulates a generic HTTP layer.\n2. A class for EventService, that has class #1 as a member variable\n3. A class for aggregation, that has class #1 as a member variable.\n\n\nDoes that seem reasonable in terms of how to break this problem down?",
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "384c2426_3f3c5d58",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 579,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-02T20:09:52Z",
      "side": 1,
      "message": "Yeah the aggregation code is adding unnecessary bloat to HttpClient.  I think your suggestion is reasonable.  I\u0027ll make aggregation its own class in the vein of EventService.  That\u0027s going to play much better with future patches where I\u0027ll need to add aggregation specific public methods.",
      "parentUuid": "931cebff_f37a6606",
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b237aebd_7ac9921d",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 579,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-02T23:32:14Z",
      "side": 1,
      "message": "In this new patchset I have created a completely separate RedfishAggregator class to handle all of the aggregation features.  HttpClient is being left as is since it is generic enough to be used by both EventService and RedfishAggregator",
      "parentUuid": "384c2426_3f3c5d58",
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ec5371eb_456d55c7",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 579,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T17:59:41Z",
      "side": 1,
      "message": "Excellent.",
      "parentUuid": "b237aebd_7ac9921d",
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6fd361f0_5a0d3d0f",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 589,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-04-30T18:05:58Z",
      "side": 1,
      "message": "Nit, when using string as a map member, it helps to denote what it is;  in this case, it\u0027s a name (I think a url piece name) mapped to a url.",
      "range": {
        "startLine": 589,
        "startChar": 0,
        "endLine": 589,
        "endChar": 68
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6f6946c5_af0079ce",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 589,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-02T20:09:52Z",
      "side": 1,
      "message": "It\u0027s a name that\u0027s used as an aliases for a satellite BMC like \"Aggregated0\" or \"Aggregated1\".  It\u0027s a mapped to a url but really that\u0027s just used to store the basic information needed to connect to that BMC.  That name is later added as a prefix to a resource ID in the URI path of a request to that satellite.",
      "parentUuid": "6fd361f0_5a0d3d0f",
      "range": {
        "startLine": 589,
        "startChar": 0,
        "endLine": 589,
        "endChar": 68
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8f0ab4aa_6fb29a87",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 589,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-02T23:32:14Z",
      "side": 1,
      "message": "I\u0027ve added the additional designation",
      "parentUuid": "6f6946c5_af0079ce",
      "range": {
        "startLine": 589,
        "startChar": 0,
        "endLine": 589,
        "endChar": 68
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1b56519e_f1a3ad6e",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 721,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-04-30T18:05:58Z",
      "side": 1,
      "message": "hmmmmm.... this kind of assumption has burned us in the past.  underscore tends to get used A LOT in names of components.  I wonder if we could come up with a rule like, underscores in the name get % encoded, to ensure they don\u0027t conflict.  Maybe there\u0027s a better delimiter we could use like a word?\n\n\n\u003cname\u003e_remoteid_\u003cremoteid\u003e ?\n\nthen when we do the split we would search for \"_remoteid_\"  Thinking out loud a bit here.",
      "range": {
        "startLine": 721,
        "startChar": 0,
        "endLine": 721,
        "endChar": 60
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c82db857_5f194136",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 721,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-02T20:09:52Z",
      "side": 1,
      "message": "In this instance the Name would be in the form of something like \"Aggregated0\", \"Aggregated1\", etc. which would serve as the prefix used in the aggregated URL.  Not allowing underscores in the prefix doesn\u0027t seem too limiting since they\u0027d still be able to be used in component names.  Using % encoding for underscores in the prefix seems like an alright compromise to me.  \n\nI like being able to assume that if aggregation is active then we\u0027ll be able to parse a URI like \"/redfish/v1/Chassis/{ChassisId}\" and assume that all text before the first underscore in \"{ChassisId}\" is actually the prefix that indicates which BMC the request is meant for (i.e. {ChassisId} \u003d\u003d \u003cName\u003e_\u003cRemoteChassisId\u003e).\n\nI think even with a word delimiter we have the same issue where we can\u0027t be sure that there wouldn\u0027t be collisions, although the likelihood would be greatly reduced.  It also makes the aggregated IDs much wordier.  I think putting some sort of restriction on what can be used as a name/prefix is the way to go.",
      "parentUuid": "1b56519e_f1a3ad6e",
      "range": {
        "startLine": 721,
        "startChar": 0,
        "endLine": 721,
        "endChar": 60
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "26c14b12_2d0efe9c",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 721,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T17:59:41Z",
      "side": 1,
      "message": "The issue your idea imposes is that now we need to add prefixes to every ID, so we can differentiate between \"is on the bmc\" and \"is aggregated\".\n\nChanging the IDs is difficult because of things like:\nhttps://github.com/openbmc/webui-vue/issues/43\n\nThat client implementations tend to do.  If we can avoid changing the existing IDs, I\u0027d really like to, and the existing IDs contain underscores;  If we had a fixed string, like \"aggregated\" at the front, that might work, then we just tell people they can\u0027t call a device \"aggregated\" which seems reasonable.",
      "parentUuid": "c82db857_5f194136",
      "range": {
        "startLine": 721,
        "startChar": 0,
        "endLine": 721,
        "endChar": 60
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "adcf8346_2f68237e",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 721,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-10T22:20:11Z",
      "side": 1,
      "message": "I noticed the hardcoded IDs and I have a later patch that works around that: https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/53310.  I haven\u0027t requested review as of posting this message because I am working through feedback on earlier patches in the chain.  \n\nBasically I perform a check before the request is actually handled.  If aggregation is enabled then I extract the prefix, delete it from the request\u0027s path, and then either forward the request to the associated satellite BMC or let the request be handled normally.\n\nThat allows the use of prefixes with IDs without having to change any of the existing paths.  The only constraint is I have to be able to extract the prefix from the ID, hence why I want to assume the prefix will not include underscores.",
      "parentUuid": "26c14b12_2d0efe9c",
      "range": {
        "startLine": 721,
        "startChar": 0,
        "endLine": 721,
        "endChar": 60
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3693faa4_77393d20",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 729,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-04-30T18:05:58Z",
      "side": 1,
      "message": "In the dbus config for this, would it make more sense to just store this as a url?\n\nie\n\nRemoteRedfishRoot \u003d \"https://192.167.1.1:443/redfish/v1\"\n\nThen use the functions we already have (parseUrlFromPieces I think is the one) to parse it into something more specific?\n\nI\u0027m genuinely asking, what you wrote is fine, I\u0027m just curious if just having a url would prevent an explosion of parameters.  For example, in this, I forsee needing to add  encryption at some point.",
      "range": {
        "startLine": 729,
        "startChar": 36,
        "endLine": 729,
        "endChar": 44
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0f98d4d6_7358002d",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 729,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-02T20:09:52Z",
      "side": 1,
      "message": "I don\u0027t think it\u0027ll make too much of a difference in the end.  In addition to encryption we will need to add other fields down the line like \"user\" and \"password\" for authentication.  I\u0027m assuming we wouldn\u0027t want to squeeze all of that into a single \"RemoteRedfishRoot\" field so we\u0027d still end up with more than just two fields.  In the dbus config I like having to explicitly set each individual parameter as its own field for readability purposes.\n\nWhat if for a future change support was added for \"RemoteRedfishRoot\" so that you could use either style or a combination of the two to provide satellite information?",
      "parentUuid": "3693faa4_77393d20",
      "range": {
        "startLine": 729,
        "startChar": 36,
        "endLine": 729,
        "endChar": 44
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5d972328_1698daf4",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 729,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T17:59:41Z",
      "side": 1,
      "message": "\u003e I don\u0027t think it\u0027ll make too much of a difference in the end.  In addition to encryption we will need to add other fields down the line like \"user\" and \"password\" for authentication.  I\u0027m assuming we wouldn\u0027t want to squeeze all of that into a single \"RemoteRedfishRoot\" field so we\u0027d still end up with more than just two fields.\n\nusername and password, probably not.\n\n\u003e  In the dbus config I like having to explicitly set each individual parameter as its own field for readability purposes.\n\nSure, like I said, I\u0027m ok with it, it just makes it different than say, event service, which takes a full uri.\n\n\u003e \n\u003e What if for a future change support was added for \"RemoteRedfishRoot\" so that you could use either style or a combination of the two to provide satellite information?\n\nI\u0027d much rather be strict in what we accept for one form or the other.  Having multiple ways to declare configs is a recipe for behavior that\u0027s inconsistent.  Even in the URI model we have in EventService we\u0027ve found that there\u0027s differences in behavior.\n\nI\u0027m fine with this as-is.",
      "parentUuid": "0f98d4d6_7358002d",
      "range": {
        "startLine": 729,
        "startChar": 36,
        "endLine": 729,
        "endChar": 44
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "741a6b3b_6058ae29",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 776,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-04-30T18:05:58Z",
      "side": 1,
      "message": "?  Can we assume http here?  Redfish the spec generally is implemented as https, although might not be in this case.",
      "range": {
        "startLine": 776,
        "startChar": 0,
        "endLine": 776,
        "endChar": 39
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d485b9c4_499134f3",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 776,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-02T20:09:52Z",
      "side": 1,
      "message": "For this patch I wanted to assume that there is no authentication and TLS required to communicate with a satellite BMC.  I\u0027m going to leave supporting those features to a future patch.\n\nSetting the scheme as http seemed like the appropriate way within boost::urls::url to denote that the config had selected no authentication.  Previously I was storing an \"authType\" field in my custom struct.",
      "parentUuid": "741a6b3b_6058ae29",
      "range": {
        "startLine": 776,
        "startChar": 0,
        "endLine": 776,
        "endChar": 39
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3f44120e_b5576082",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 776,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-05-06T17:59:41Z",
      "side": 1,
      "message": "\u003e For this patch I wanted to assume that there is no authentication and TLS required to communicate with a satellite BMC.  I\u0027m going to leave supporting those features to a future patch.\n\nCan you make mention of that in your commit message?  I think it\u0027s fine, the only thing I worry about is http being the \"default\" if no encryption property is specified, but I suspect that will come in short order.  FWIW, \"encryption\" should be a required parameter at some point.\n\n\u003e \n\u003e Setting the scheme as http seemed like the appropriate way within boost::urls::url to denote that the config had selected no authentication.  Previously I was storing an \"authType\" field in my custom struct.\n\nI\u0027m assuming you meant \"encryption\", not \"authentication\" here, but yes, I think you got the URI behavior right.",
      "parentUuid": "d485b9c4_499134f3",
      "range": {
        "startLine": 776,
        "startChar": 0,
        "endLine": 776,
        "endChar": 39
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0f030d87_df8646a9",
        "filename": "http/http_client.hpp",
        "patchSetId": 12
      },
      "lineNbr": 776,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2022-05-10T22:20:11Z",
      "side": 1,
      "message": "\u003e Can you make mention of that in your commit message? \nDone\n\n\u003e I\u0027m assuming you meant \"encryption\", not \"authentication\" here\nNo I meant authentication as in a satellite BMC could require users to login.  The aggregating BMC would need a username and password to login first so that it could acquire an Auth-Token.  I don\u0027t want to add support for that as part of this patch.  Using \"http\" to denote this is at best confusing so I\u0027m open to changing the code if there\u0027s a way to separate encryption and decryption within boost::urls::url.",
      "parentUuid": "3f44120e_b5576082",
      "range": {
        "startLine": 776,
        "startChar": 0,
        "endLine": 776,
        "endChar": 39
      },
      "revId": "236516d1e63e83d5a430965747be8399963fe15f",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}