{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "623e9d9f_40a1c70d",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 708,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-24T19:31:57Z",
      "side": 1,
      "message": "If we use boost::beast::file_posix here, we avoid a lot of calls to close() in all the error cases.  Something to consider.\nhttps://www.boost.org/doc/libs/1_82_0/libs/beast/doc/html/beast/ref/boost__beast__file_posix.html\n\n\nAt some point https://gerrit.openbmc.org/c/openbmc/bmcweb/+/35992 will go in, and that will simplify this code quite a bit.",
      "range": {
        "startLine": 708,
        "startChar": 4,
        "endLine": 708,
        "endChar": 7
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3a5cda58_67053199",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 708,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-09-05T18:14:46Z",
      "side": 1,
      "message": "My preference is to wait for that other CL to go in and then we can update all of the file descriptor code at once.",
      "parentUuid": "623e9d9f_40a1c70d",
      "range": {
        "startLine": 708,
        "startChar": 4,
        "endLine": 708,
        "endChar": 7
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "aa9112ca_edd52f9e",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 708,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-10-18T01:14:23Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3a5cda58_67053199",
      "range": {
        "startLine": 708,
        "startChar": 4,
        "endLine": 708,
        "endChar": 7
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1da69810_28be2810",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 736,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-24T19:31:57Z",
      "side": 1,
      "message": "This doesn\u0027t look used anymore?",
      "range": {
        "startLine": 736,
        "startChar": 22,
        "endLine": 736,
        "endChar": 26
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6a10af4f_db6321b3",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 736,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-08-28T16:26:21Z",
      "side": 1,
      "message": "You\u0027re right, removed",
      "parentUuid": "1da69810_28be2810",
      "range": {
        "startLine": 736,
        "startChar": 22,
        "endLine": 736,
        "endChar": 26
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "45dccc5a_c9bcf3e1",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 763,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-24T19:31:57Z",
      "side": 1,
      "message": "\"param\" needs a better name.  EntryID, then change line 772 to \"entryIdEscaped\"?",
      "range": {
        "startLine": 763,
        "startChar": 41,
        "endLine": 763,
        "endChar": 46
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8d588c27_ea8b567b",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 763,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-09-05T18:14:46Z",
      "side": 1,
      "message": "I renamed param and after some refactoring I was able to remove the original entryID variable on line 772.",
      "parentUuid": "45dccc5a_c9bcf3e1",
      "range": {
        "startLine": 763,
        "startChar": 41,
        "endLine": 763,
        "endChar": 46
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "737f70d7_94e38471",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 773,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-24T19:31:57Z",
      "side": 1,
      "message": "New code should be using object_path operator /\u003d to escape dbus paths.",
      "range": {
        "startLine": 773,
        "startChar": 0,
        "endLine": 773,
        "endChar": 46
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "27c57359_255f11c4",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 773,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-09-05T18:14:46Z",
      "side": 1,
      "message": "I think I did that correctly.  Please reopen if not.",
      "parentUuid": "737f70d7_94e38471",
      "range": {
        "startLine": 773,
        "startChar": 0,
        "endLine": 773,
        "endChar": 46
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4f2901ec_2c77a4cd",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 789,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-24T19:31:57Z",
      "side": 1,
      "message": "Please make a normal method (probably just roll the error handling into downloadDumpEntryCallback).",
      "range": {
        "startLine": 777,
        "startChar": 0,
        "endLine": 789,
        "endChar": 53
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b90ff2b8_c4e90d84",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 789,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-09-05T18:14:46Z",
      "side": 1,
      "message": "I rolled the error checking into DumpEntryCallback()",
      "parentUuid": "4f2901ec_2c77a4cd",
      "range": {
        "startLine": 777,
        "startChar": 0,
        "endLine": 789,
        "endChar": 53
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd7a6fc0_89197aa1",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 796,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-24T19:31:57Z",
      "side": 1,
      "message": "See above.  Please use object_path for constructing dbus paths in new code.",
      "range": {
        "startLine": 794,
        "startChar": 8,
        "endLine": 796,
        "endChar": 19
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7b970f0f_6613a739",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 796,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-09-05T18:14:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "cd7a6fc0_89197aa1",
      "range": {
        "startLine": 794,
        "startChar": 8,
        "endLine": 796,
        "endChar": 19
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bb1f88c1_3fadeb40",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 2122,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-24T19:31:57Z",
      "side": 1,
      "message": "\u003c\u003d\n\nI think?",
      "range": {
        "startLine": 2122,
        "startChar": 21,
        "endLine": 2122,
        "endChar": 24
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "74c842a2_b423a4ec",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 2122,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-08-28T16:26:21Z",
      "side": 1,
      "message": "The documentation I\u0027ve seen online for lseek says -1 on failure or the offset from the start on success.  \"0\" would be a valid offset for the start of the file.  We have been using \u0027\u003d\u003d -1\u0027, but I\u0027ll change all lseeks to \"\u003c 0\" per your previous comment on line #773.",
      "parentUuid": "bb1f88c1_3fadeb40",
      "range": {
        "startLine": 2122,
        "startChar": 21,
        "endLine": 2122,
        "endChar": 24
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7f07ffad_035f1605",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 2122,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-28T19:19:15Z",
      "side": 1,
      "message": "If the file is of zero length, we should be sending an error back to the user, no?\n\nYes, a file of zero length is valid (ie, why lseek returning zero is valid) but a completely empty file for a crashdump isnt valid, right?",
      "parentUuid": "74c842a2_b423a4ec",
      "range": {
        "startLine": 2122,
        "startChar": 21,
        "endLine": 2122,
        "endChar": 24
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e1144780_30ab0621",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 2122,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-08-28T20:44:11Z",
      "side": 1,
      "message": "From that standpoint yeah there probably isn\u0027t a valid usecase where a dump is created that\u0027s just an empty file.  I\u0027ll make it \"\u003c\u003d 0\" and just add some additional error logging to these places to denote if the 500 Internal Error was caused by an empty file or lseek() encountering an error.",
      "parentUuid": "7f07ffad_035f1605",
      "range": {
        "startLine": 2122,
        "startChar": 21,
        "endLine": 2122,
        "endChar": 24
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c4041826_f58a6060",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 2122,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-08-28T20:56:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e1144780_30ab0621",
      "range": {
        "startLine": 2122,
        "startChar": 21,
        "endLine": 2122,
        "endChar": 24
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f6d27f30_e5a7b43a",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 2983,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-24T19:31:57Z",
      "side": 1,
      "message": "this isn\u0027t a method in the redfish tree.  setupRedfishRoute is inappropriate.",
      "range": {
        "startLine": 2980,
        "startChar": 0,
        "endLine": 2983,
        "endChar": 5
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "281a4a72_23409e56",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 2983,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-08-28T16:26:21Z",
      "side": 1,
      "message": "We have this for the other attachment download URIs\n\nhttps://github.com/openbmc/bmcweb/blob/master/redfish-core/lib/log_services.hpp#L1973-L1976\n\nhttps://github.com/openbmc/bmcweb/blob/master/redfish-core/lib/log_services.hpp#L4143-L4146\n\nAlso, if we don\u0027t include this then we won\u0027t be able to retrieve dumps via Redfish aggregation since the aggregation hook is within setUpRedfishRoute().",
      "parentUuid": "f6d27f30_e5a7b43a",
      "range": {
        "startLine": 2980,
        "startChar": 0,
        "endLine": 2983,
        "endChar": 5
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d2a41195_b68e1207",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 2983,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-28T19:19:15Z",
      "side": 1,
      "message": "\u003e We have this for the other attachment download URIs\n\u003e \n\u003e https://github.com/openbmc/bmcweb/blob/master/redfish-core/lib/log_services.hpp#L1973-L1976\n\u003e \n\u003e https://github.com/openbmc/bmcweb/blob/master/redfish-core/lib/log_services.hpp#L4143-L4146\n\nThey are also incorrect, likely done as part of the migration, and somehthing we\u0027ll need to fix.\n\n\u003e \n\u003e Also, if we don\u0027t include this then we won\u0027t be able to retrieve dumps via Redfish aggregation since the aggregation hook is within setUpRedfishRoute().\n\nOOOF......  First, lets agree on correct behavior.  For URLs that don\u0027t exist in the redfish tree we should be aggregating them, but NOT applying query params.  Sound correct?\n\nIn that case, I wonder if we need to roll out https://github.com/openbmc/bmcweb/blob/8e73b9064fdd414b9a71806a44f0e0f176b5a88d/redfish-core/include/query.hpp#L150C1-L172C8\n\nThis block of code into a separate \"Call for non Redfish but still want aggregated routes\". WDYT?",
      "parentUuid": "281a4a72_23409e56",
      "range": {
        "startLine": 2980,
        "startChar": 0,
        "endLine": 2983,
        "endChar": 5
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "56f0a13b_f9e8146c",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 2983,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2023-08-28T19:20:17Z",
      "side": 1,
      "message": "Actually, maybe it\u0027s easier, maybe we call beginAggregation instead of setupRedfishRoute?",
      "parentUuid": "d2a41195_b68e1207",
      "range": {
        "startLine": 2980,
        "startChar": 0,
        "endLine": 2983,
        "endChar": 5
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "39611fe2_e641ebec",
        "filename": "redfish-core/lib/log_services.hpp",
        "patchSetId": 14
      },
      "lineNbr": 2983,
      "author": {
        "id": 1001303
      },
      "writtenOn": "2023-08-28T20:44:11Z",
      "side": 1,
      "message": "\u003e OOOF...... First, lets agree on correct behavior. For URLs that don\u0027t exist in the redfish tree we should be aggregating them, but NOT applying query params. Sound correct?\n\nYes that sounds right.\n\n\u003e In that case, I wonder if we need to roll out https://github.com/openbmc/bmcweb/blob/8e73b9064fdd414b9a71806a44f0e0f176b5a88d/redfish-core/include/query.hpp#L150C1-L172C8\n\u003e This block of code into a separate \"Call for non Redfish but still want aggregated routes\". WDYT?\n\u003e\n\u003e Actually, maybe it\u0027s easier, maybe we call beginAggregation instead of setupRedfishRoute?\n\nI think we\u0027d want to go with the first option, but in a scenario like this won\u0027t we want to do all 3 of these?\n\n1) Check the header https://github.com/openbmc/bmcweb/blob/8e73b9064fdd414b9a71806a44f0e0f176b5a88d/redfish-core/include/query.hpp#L123-L134\n\n2) Check the credentials https://github.com/openbmc/bmcweb/blob/8e73b9064fdd414b9a71806a44f0e0f176b5a88d/redfish-core/include/query.hpp#L143-L146\n\n3) Check for aggregation (if even enabled)\n\nIt doesn\u0027t look as clean to break those out into a single function since there is this check before the first two items https://github.com/openbmc/bmcweb/blob/8e73b9064fdd414b9a71806a44f0e0f176b5a88d/redfish-core/include/query.hpp#L136-L141.\n\nI can either include that query param check in the broken out function behind a flag or breakout into two separate functions and then wrap them in a third function that would only be called in situations where we don\u0027t want query params.  Do you have a preference or a better idea?",
      "parentUuid": "56f0a13b_f9e8146c",
      "range": {
        "startLine": 2980,
        "startChar": 0,
        "endLine": 2983,
        "endChar": 5
      },
      "revId": "46e63e4e5a6488df0a121c95a5153b7b36f8964e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}