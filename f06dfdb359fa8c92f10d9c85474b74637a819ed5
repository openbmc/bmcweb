{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "33143daa_ee0d5848",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-09-13T15:34:35Z",
      "side": 1,
      "message": "I‚Äôm pretty sure this is actually a bug in the mapper, and you‚Äôll find that depending on which mapper path you take, you might get these interfaces or not.",
      "revId": "f06dfdb359fa8c92f10d9c85474b74637a819ed5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "36450ba6_fb19778b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-09-13T19:16:37Z",
      "side": 1,
      "message": "https://github.com/openbmc/phosphor-objmgr/blob/c363323e7ee9e42817922346b1f1ce6adc872d1b/src/processing.cpp#L151\n\nThose default interfaces just need removed.",
      "parentUuid": "33143daa_ee0d5848",
      "revId": "f06dfdb359fa8c92f10d9c85474b74637a819ed5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81bfb999_22c960a3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2024-09-18T03:19:31Z",
      "side": 1,
      "message": "The \"default interfaces\" were introduced https://github.com/openbmc/phosphor-objmgr/commit/70461896775208bbe400cc23786ce4d17a0c07f7\n\nI guess it was \"intended behavior\" to add the default interfaces to the parent objects.  @geissonator Do you know why?\n\nBut I agree with @Ed that the default interfaces shall not be added to the parent objects, because such objects do not really implement such interfaces, and cause the issue described here.\n\nAlso + @stwcx, could you weigh in and see if we should remove the default interfaces added in object mapper?",
      "parentUuid": "36450ba6_fb19778b",
      "revId": "f06dfdb359fa8c92f10d9c85474b74637a819ed5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cffd6d71_2b5c0171",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000020
      },
      "writtenOn": "2024-09-19T19:35:45Z",
      "side": 1,
      "message": "Push a change to phosphor-objmgr? Lead by code?",
      "parentUuid": "81bfb999_22c960a3",
      "revId": "f06dfdb359fa8c92f10d9c85474b74637a819ed5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "56a8b514_d5413cb5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2024-09-23T09:14:28Z",
      "side": 1,
      "message": "I tried to remove the \"default interfaces\" in phosphor-objmgr, and it\u0027s found that it may not be the correct way.\n\nHere are the details:\n1. D-Bus does implement the default interfaces on any object path, e.g.\n```bash\n busctl introspect xyz.openbmc_project.Software.BMC.Updater /xyz\nNAME                                TYPE      SIGNATURE RESULT/VALUE FLAGS\norg.freedesktop.DBus.Introspectable interface -         -            -\n.Introspect                         method    -         s            -\norg.freedesktop.DBus.Peer           interface -         -            -\n.GetMachineId                       method    -         s            -\n.Ping                               method    -         -            -\norg.freedesktop.DBus.Properties     interface -         -            -\n.Get                                method    ss        v            -\n.GetAll                             method    s         a{sv}        -\n.Set                                method    ssv       -            -\n.PropertiesChanged                  signal    sa{sv}as  -            -\n```\nIt applies to all the parent object path until `/`.\nThis means the mapper is \"valid\" to add default interfaces in its map.\n\n2. If we do remove the default interfaces in the mapper, this results in the below behavior:\n```bash\n# busctl call xyz.openbmc_project.ObjectMapper /xyz/openbmc_project/object_mapper xyz.openbmc_project.ObjectMapper GetObject sas /xyz/openbmc_project/software/c172a378 0\na{sas} 2 \"xyz.openbmc_project.ObjectMapper\" 0 \"xyz.openbmc_project.Software.BMC.Updater\" 11 \"org.freedesktop.DBus.Introspectable\" \"org.freedesktop.DBus.Peer\" \"org.freedesktop.DBus.Properties\" \"xyz.openbmc_project.Association.Definitions\n\" \"xyz.openbmc_project.Common.FilePath\" \"xyz.openbmc_project.Inventory.Decorator.Compatible\" \"xyz.openbmc_project.Object.Delete\" \"xyz.openbmc_project.Software.Activation\" \"xyz.openbmc_project.Software.ExtendedVersion\" \"xyz.openbmc_proje\nct.Software.RedundancyPriority\" \"xyz.openbmc_project.Software.Version\"\n```\nIt shows that mapper\u0027s `GetObject` method tells that the `xyz.openbmc_project.ObjectMapper` service implements an object /xyz/openbmc_project/software/c172a378, but it has no interfaces.\nThis is considered invalid.\n\n3. The systemd D-Bus does have a weird behavior:\n```bash\n# busctl call xyz.openbmc_project.ObjectMapper /xyz/openbmc_project/software/c172a378 org.freedesktop.DBus.Peer GetMachineId\ns \"a9af6f883ddf45289683c9583541a5ba\"\n# busctl call xyz.openbmc_project.ObjectMapper /xyz/openbmc_project/software/c172a378/inventory org.freedesktop.DBus.Properties GetAll s org.freedesktop.DBus.Introspectable\na{sv} 0\n# busctl call xyz.openbmc_project.ObjectMapper /xyz/openbmc_project/software/c172a378 org.freedesktop.DBus.Properties GetAll s org.freedesktop.DBus.Introspectable\nCall failed: Unknown object \u0027/xyz/openbmc_project/software/c172a378\u0027.\n```\n\n   * The call of `GetAll` works OK if the service creates the object, but fails if the object is a parent.\n   * The call of `GetMachineId` works OK for both objects.\nThis may indicate some unexpected behavior in systemd?",
      "parentUuid": "cffd6d71_2b5c0171",
      "revId": "f06dfdb359fa8c92f10d9c85474b74637a819ed5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fd1858f1_37940a8e",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-09-23T15:49:48Z",
      "side": 1,
      "message": "I\u0027m not following the above.  I\u0027ve read it a couple of times, and I don\u0027t understand what test you did.  Can you push the code somewhere?\n\nFYI, the default interfaces was checked in originally by me, here:\nhttps://github.com/openbmc/phosphor-objmgr/commit/605206314f23710ef8a429745f139c891630588f#diff-34d21af3c614ea3cee120df276c9c4ae95053830d7f1d3deaf009a4625409ad2R145\n\nThat was based on the idea that we should mirror all interfaces, not just the OpenBMC ones.  Realistically, these interfaces shouldn\u0027t really be returned by the mapper ever.  FWIW, this generation is already inconsistent;  If the code takes the Introspect path, the default interfaces will be added.  If the code takes the object manager path, the interfaces will not be added.\n\nThe patch I\u0027d like to see is to simply remove that defaultIfaces struct, and verify that those interfaces no longer respond in queries.\nhttps://github.com/openbmc/phosphor-objmgr/blob/7a93d516522f58b887a05cc93ff27a6674601e5f/src/processing.cpp#L151\n\nIf you\u0027d like me to put up the patch I can, but it\u0027ll take me some time.",
      "parentUuid": "56a8b514_d5413cb5",
      "revId": "f06dfdb359fa8c92f10d9c85474b74637a819ed5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3e7eaa4c_323d04a5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2024-09-24T02:10:37Z",
      "side": 1,
      "message": "\u003e The patch I\u0027d like to see is to simply remove that defaultIfaces struct, and verify that those interfaces no longer respond in queries.\n\nThat\u0027s exactly what I tested.\nI will push the change anyway and we could discuss there.",
      "parentUuid": "fd1858f1_37940a8e",
      "revId": "f06dfdb359fa8c92f10d9c85474b74637a819ed5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "921837a4_1da3f485",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-09-24T02:37:59Z",
      "side": 1,
      "message": "üëç",
      "parentUuid": "3e7eaa4c_323d04a5",
      "revId": "f06dfdb359fa8c92f10d9c85474b74637a819ed5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0087f850_63fb148d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000044
      },
      "writtenOn": "2024-09-24T02:46:28Z",
      "side": 1,
      "message": "https://gerrit.openbmc.org/c/openbmc/phosphor-objmgr/+/74832\n\nLet\u0027s discuss phosphor-objmgr changes there.",
      "parentUuid": "921837a4_1da3f485",
      "revId": "f06dfdb359fa8c92f10d9c85474b74637a819ed5",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}