{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "16df91f3_cbbdd84d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2024-10-14T17:00:16Z",
      "side": 1,
      "message": "This patch needed rebased, and had some lifetime issues as written.  I\u0027ve rewritten some portions to set up shared_from_this so we get proper lifetimes for subscriptions on delete that might not have all their connections closed.\n\nI haven\u0027t tested it, so PTAL and see if it passes your tests.",
      "revId": "3da1f6c3309be413e106afbc5ff1a9f7a14bbb7e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8b1d55f5_9d1a683f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1001604
      },
      "writtenOn": "2024-10-14T22:42:12Z",
      "side": 1,
      "message": "I found out there is a bug in https://gerrit.openbmc.org/c/openbmc/bmcweb/+/65720 and I submitted a fix https://gerrit.openbmc.org/c/openbmc/bmcweb/+/75296.\n\nI\u0027ll rebase it when ready",
      "parentUuid": "16df91f3_cbbdd84d",
      "revId": "3da1f6c3309be413e106afbc5ff1a9f7a14bbb7e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "41734a6b_df9558a8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1001604
      },
      "writtenOn": "2024-10-15T23:19:37Z",
      "side": 1,
      "message": "With this, I\u0027m seeing the bad_weak_ptr like\n```\nOct 15 22:48:40 p10bmc bmcwebd[6227]: terminate called after throwing an instance of \u0027std::bad_weak_ptr\u0027\nOct 15 22:48:40 p10bmc bmcwebd[6227]:   what():  bad_weak_ptr\nOct 15 22:48:41 p10bmc systemd[1]: bmcweb.service: Main process exited, code\u003ddumped, status\u003d6/ABRT\nOct 15 22:48:41 p10bmc systemd[1]: bmcweb.service: Failed with result \u0027core-dump\u0027.\nOct 15 23:03:04 p10bmc systemd[1]: Started Start bmcwebd server.\n```\n\nI think this seems related to the class `Subscription` and there seems a mismatch when it is shared.\n\nI\u0027ll keep looking at it.\n\n```\nclass Subscription : std::enable_shared_from_this\u003cSubscription\u003e\n\n...\n\n            client-\u003esendDataWithCallback(\n....\n                std::bind_front(\u0026Subscription::resHandler, this,\n                                shared_from_this()));\n                                \n                                \n```",
      "parentUuid": "8b1d55f5_9d1a683f",
      "revId": "3da1f6c3309be413e106afbc5ff1a9f7a14bbb7e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2070043b_38e87794",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1000020
      },
      "writtenOn": "2024-10-18T17:44:20Z",
      "side": 1,
      "message": "https://gerrit.openbmc.org/c/openbmc/bmcweb/+/75296 merged. So I think we are good here?",
      "parentUuid": "41734a6b_df9558a8",
      "revId": "3da1f6c3309be413e106afbc5ff1a9f7a14bbb7e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "03849138_f6164ec8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1001604
      },
      "writtenOn": "2024-10-18T18:16:37Z",
      "side": 1,
      "message": "Even after rebase, this still does not work.\n\n1. When using `shared_from_this()` (e.g. patchset 11), it caused `bad_weak_ptr` exception like\n```\nOct 15 22:48:40 p10bmc bmcwebd[6227]: terminate called after throwing an instance of \u0027std::bad_weak_ptr\u0027\nOct 15 22:48:40 p10bmc bmcwebd[6227]:   what():  bad_weak_ptr\n```\n\nI think in the process of this code path, Subscription shared_ptr may have been released.\n\n2. Even with the change as the current patchset 14, it still fails to cause SEQV like\n```\nOct 18 17:01:08 p10bmc systemd[1]: bmcweb.service: Main process exited, code\u003ddumped, status\u003d11/SEGV\nOct 18 17:01:08 p10bmc systemd[1]: bmcweb.service: Failed with result \u0027core-dump\u0027.\n```\n\n----\nI\u0027ll keep looking",
      "parentUuid": "41734a6b_df9558a8",
      "revId": "3da1f6c3309be413e106afbc5ff1a9f7a14bbb7e",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}