{
  "comments": [
    {
      "key": {
        "uuid": "0bf8ecda_de66d68d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-09-30T15:17:34Z",
      "side": 1,
      "message": "50/72 please",
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dbe8dbf5_b8f0b71f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1000397
      },
      "writtenOn": "2021-10-01T01:53:27Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0bf8ecda_de66d68d",
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "74b9c231_606b157d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-09-30T15:17:34Z",
      "side": 1,
      "message": "This seems like a bug in the webui?  Is there a reason to think that Redfish should allow setting an empty string over redfish?",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7c2776fe_f0458e8b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000397
      },
      "writtenOn": "2021-10-01T01:53:27Z",
      "side": 1,
      "message": "\u003e This seems like a bug in the webui? \n\nI do not think so, webui just sends a structure, like this:\n```\ndateTimeForm.ntpServersArray \u003d [\n          this.form.ntp.firstAddress,\n          this.form.ntp.secondAddress,\n          this.form.ntp.thirdAddress,\n        ];\n```\nhttps://github.com/openbmc/webui-vue/blob/master/src/views/Settings/DateTime/DateTime.vue#L359-L363\nIt doesn\u0027t care about the data inside, which means that the data can be empty or repeated, like this:\n192.168.1.1 192.168.1.1 \"\"\nor\n\"\" 192.168.1.1 192.168.1.2\n\nHowever, these values need to be further processed when bmcweb parses to ntpServers. At present, it only does the work of `deduplication`, and does not handle the empty string operation.\n\n\u003e Is there a reason to think that Redfish should allow setting an empty string over redfish?\n\nFrom the redifsh spec, it only shows that NTPServers is an array, and this array can be empty, but it doesn\u0027t care whether the value inside is empty.\nhttp://redfish.dmtf.org/schemas/v1/ManagerNetworkProtocol.v1_8_0.json\n\nIf it contains a null value, it will be updated to D-Bus and 00-bmc-ethX.network, like this:\n```\n# cat  00-bmc-eth0.network \n[Match]\nName\u003deth0\n[Link]\nMACAddress\u003d66:1e:ed:f8:a4:27\n[Network]\nLinkLocalAddressing\u003dyes\nIPv6AcceptRA\u003dfalse\nNTP\u003d\nNTP\u003dcn.pool.ntp.org\nDHCP\u003dtrue\n[DHCP]\nClientIdentifier\u003dmac\nUseDNS\u003dtrue\nUseNTP\u003dtrue\nUseHostname\u003dtrue\nSendHostname\u003dtrue\n```",
      "parentUuid": "74b9c231_606b157d",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7ff0a7b4_e8881392",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-10-05T21:20:32Z",
      "side": 1,
      "message": "\u003e \u003e This seems like a bug in the webui? \n\u003e \n\u003e I do not think so, webui just sends a structure, like this:\n\u003e ```\n\u003e dateTimeForm.ntpServersArray \u003d [\n\u003e           this.form.ntp.firstAddress,\n\u003e           this.form.ntp.secondAddress,\n\u003e           this.form.ntp.thirdAddress,\n\u003e         ];\n\u003e ```\n\u003e https://github.com/openbmc/webui-vue/blob/master/src/views/Settings/DateTime/DateTime.vue#L359-L363\n\u003e It doesn\u0027t care about the data inside, which means that the data can be empty or repeated, like this:\n\u003e 192.168.1.1 192.168.1.1 \"\"\n\u003e or\n\u003e \"\" 192.168.1.1 192.168.1.2\n\u003e \n\nRight..... that\u0027s the bug I\u0027m talking about.  If the UI has a fixed number of elements for a variable array API, it needs to be looking at the data and doing the filtering itself. \n\n\u003e However, these values need to be further processed when bmcweb parses to ntpServers. At present, it only does the work of `deduplication`, and does not handle the empty string operation.\n\nPer the Redfish specification, we don\u0027t support empty strings in an array being used as a \"null\" value.\n\nI still assert this is a bug in the webui.\n\n\u003e \n\u003e \u003e Is there a reason to think that Redfish should allow setting an empty string over redfish?\n\u003e \n\u003e From the redifsh spec, it only shows that NTPServers is an array, and this array can be empty, but it doesn\u0027t care whether the value inside is empty.\n\nFrom crud semantics, bmcweb should reject any empty string, condiering this property \"shall contain all the NTP servers for which this manager is using to obtain time.\"\n\nand \"\" is not a valid NTP server.\n\n\u003e http://redfish.dmtf.org/schemas/v1/ManagerNetworkProtocol.v1_8_0.json\n\u003e \n\u003e If it contains a null value, it will be updated to D-Bus and 00-bmc-ethX.network, like this:\n\nThat is another bug, Phosphor-Networkd should not accept a blank NTP server string, and should be checking for basic FQDN url compliance before accepting and blindly putting it into the config file.\n\n\u003e ```\n\u003e # cat  00-bmc-eth0.network \n\u003e [Match]\n\u003e Name\u003deth0\n\u003e [Link]\n\u003e MACAddress\u003d66:1e:ed:f8:a4:27\n\u003e [Network]\n\u003e LinkLocalAddressing\u003dyes\n\u003e IPv6AcceptRA\u003dfalse\n\u003e NTP\u003d\n\u003e NTP\u003dcn.pool.ntp.org\n\u003e DHCP\u003dtrue\n\u003e [DHCP]\n\u003e ClientIdentifier\u003dmac\n\u003e UseDNS\u003dtrue\n\u003e UseNTP\u003dtrue\n\u003e UseHostname\u003dtrue\n\u003e SendHostname\u003dtrue\n\u003e ```",
      "parentUuid": "7c2776fe_f0458e8b",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cb2209e6_128dfda8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000397
      },
      "writtenOn": "2021-10-07T02:52:46Z",
      "side": 1,
      "message": "\u003e  that\u0027s the bug I\u0027m talking about.  If the UI has a fixed number of elements for a variable array API, it needs to be looking at the data and doing the filtering itself. \n\nIf this is a webUI bug, then for lines https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/47344/2/redfish-core/lib/network_protocol.hpp:419-423, should it also be handled in webUI? bmcweb only needs to get the attribute value of ntpServers?\n\n\u003e I still assert this is a bug in the webui.\n\nEven if this is a webUI bug, do we need to do further verification in bmcweb?",
      "parentUuid": "7ff0a7b4_e8881392",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27d7b86d_6df51f7b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-10-07T15:41:12Z",
      "side": 1,
      "message": "\u003e \u003e  that\u0027s the bug I\u0027m talking about.  If the UI has a fixed number of elements for a variable array API, it needs to be looking at the data and doing the filtering itself. \n\u003e \n\u003e If this is a webUI bug, then for lines https://gerrit.openbmc-project.xyz/c/openbmc/bmcweb/+/47344/2/redfish-core/lib/network_protocol.hpp:419-423, should it also be handled in webUI? bmcweb only needs to get the attribute value of ntpServers?\n\nYes, those lines are incorrect as well.  They are another example of putting business logic in bmcweb that should be in phosphor-networkd.\n\n\u003e \n\u003e \u003e I still assert this is a bug in the webui.\n\u003e \n\u003e Even if this is a webUI bug, do we need to do further verification in bmcweb?\n\nphosphor-networkd is where we should be doing the validation, but yes, the bmc should be doing more validation.",
      "parentUuid": "cb2209e6_128dfda8",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6fc0da2f_fe2c035f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000397
      },
      "writtenOn": "2021-10-08T05:46:28Z",
      "side": 1,
      "message": "\u003e Yes, those lines are incorrect as well.  They are another example of putting business logic in bmcweb that should be in phosphor-networkd.\n\nso, Do I need to abandon this patch and fix it in phosphor-networkd?\n\n\u003e phosphor-networkd is where we should be doing the validation, but yes, the bmc should be doing more validation.\n\nDoes bmcweb need to do this verification?",
      "parentUuid": "27d7b86d_6df51f7b",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eb1e71cf_77ad67dd",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000396
      },
      "writtenOn": "2021-10-11T16:50:08Z",
      "side": 1,
      "message": "@ed so on the front end, should we be passing in null for empty NTP server form fields instead of \"\"?",
      "parentUuid": "6fc0da2f_fe2c035f",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "35fc7bbc_3e93af9f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-10-11T18:00:17Z",
      "side": 1,
      "message": "No, you should be passing the array of NTP servers as you want them.  So if you have one server, pass\n\nNTPServers: [\"www.foobar.com\"]\n\nIf you have two servers:\nNTPServers: [\"www.foobar.com\", \"www.extrafoobar.com\"]\n\nThere should be no null, or empty string in the list.\n\nNow, this assumes that the UI has access to the current servers, and is doing read-modify-write.  In the specification, technically PATCHING [{}, nullptr] is in fact allowed to atomically delete an entry index from the table without effecting the others, but given the way the UI works with a fixed set of items, and a single submit button, I\u0027d be surprised if you needed that behavior, as it can always just set the whole list.",
      "parentUuid": "eb1e71cf_77ad67dd",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b37cb3cd_ffff47f5",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000396
      },
      "writtenOn": "2021-10-11T18:35:55Z",
      "side": 1,
      "message": "If [1.1.1.1, 2.2.2.2, 3.3.3.3] is displayed in the UI and a user removes 2.2.2.2 from the input field and saves, what should the patch look like? \n[1.1.1.1, null, 3.3.3.3]?",
      "parentUuid": "35fc7bbc_3e93af9f",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "47247e80_cf1baebc",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000020
      },
      "writtenOn": "2021-10-11T18:58:37Z",
      "side": 1,
      "message": "\u003e If [1.1.1.1, 2.2.2.2, 3.3.3.3] is displayed in the UI and a user removes 2.2.2.2 from the input field and saves, what should the patch look like? \n\u003e [1.1.1.1, null, 3.3.3.3]?\n\n\nNo, I would think [1.1.1.1, 3.3.3.3]\n\nWhat happens if the client has [1.1.1.1] and wants to remove it? i.e. have no NTP servers.",
      "parentUuid": "b37cb3cd_ffff47f5",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "76faf09a_29cc9b87",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000396
      },
      "writtenOn": "2021-10-11T19:08:36Z",
      "side": 1,
      "message": "We didn\u0027t allow that on the front end, if all fields were empty and you try to save then the form validation would say field required. \n\nI opened an issue for this https://github.com/openbmc/webui-vue/issues/81 feel free to leave a comment on the story if I missed the mark on the issue description",
      "parentUuid": "47247e80_cf1baebc",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "e91a158459b6697398c92d98c964dc9c29ffc733",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    }
  ]
}