{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "c12febe4_49bbd5d0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000235
      },
      "writtenOn": "2022-01-04T16:06:35Z",
      "side": 1,
      "message": "I think BMCWeb should check if the user trying to log in has the \"Login\" privilege.",
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d6aa1a02_cfb8134d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000235
      },
      "writtenOn": "2022-01-06T19:01:54Z",
      "side": 1,
      "message": "Regardless of if we have disabled user accounts, I think BMCWeb login operations should be enhanced so they only allow the login operation to succeed if the user trying to login has the Redfish Login privilege.",
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e510ca02_d2726c55",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-01-10T17:11:12Z",
      "side": 1,
      "message": "So long as you mean \"So the user behavior works correctly\" I\u0027m fine with that.  But given that this looks like a phosphor-user-manager failure, I don\u0027t want that business logic to be in bmcweb.  If we\u0027re on the same page there, great.",
      "parentUuid": "d6aa1a02_cfb8134d",
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d587922e_841cd079",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 230,
      "author": {
        "id": 1000235
      },
      "writtenOn": "2022-01-04T16:06:35Z",
      "side": 1,
      "message": "Per my proposed design (see notes below), this line of code should be changed to:\nUse the user\u0027s role to retrieve the set of Privileges, then check if the \"Login\" privelege is present.   If so then proceed, otherwise error out with \"accessDenied\".",
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5157a043_4e2ce7d4",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 230,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2022-01-07T10:10:18Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "d587922e_841cd079",
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f5ff2ccb_91799a83",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-05T19:58:58Z",
      "side": 1,
      "message": "This kind of business logic should not be in bmcweb.  If users with no-access shouldn\u0027t be allowed to log in, then they should be rejected by PAM/phosphor-user-manager.",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "defd93cc_2e6f064c",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-05T20:01:19Z",
      "side": 1,
      "message": "To be more concrete, this is the check to determine if a user is allowed to log in, using the standard pam mechanisms.\n\nhttps://github.com/openbmc/bmcweb/blob/889ff6943d62762eeaf58824b651d2edaf940d1d/include/pam_authenticate.hpp#L98\n\nIf this is succeeding for NoAccess users that means that phosphor-user-manager has failed its API guarantees, and hasn\u0027t disabled the user properly.",
      "parentUuid": "f5ff2ccb_91799a83",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52c11756_2e642cdb",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-06T04:22:07Z",
      "side": 1,
      "message": "Yes Ed. I was also checking in the same lines after pushing the commit. I will check and see how to handle this at the user manager and will update here",
      "parentUuid": "defd93cc_2e6f064c",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3767fd46_b02f1381",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-06T10:38:09Z",
      "side": 1,
      "message": "I made these changes to get the https://github.com/openbmc/bmcweb/blob/master/http/routing.hpp#L1415 logic applied when the redfish session is getting created. This will validate the remote user\u0027s privilege while logging in. \n\nI believe the pam authentication does not cover the validation for roles, priv etc for the remote users. Am i missing something here?",
      "parentUuid": "52c11756_2e642cdb",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b9d6a4e3_f051f770",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-06T19:17:56Z",
      "side": 1,
      "message": "\u003e I made these changes to get the https://github.com/openbmc/bmcweb/blob/master/http/routing.hpp#L1415 logic applied when the redfish session is getting created. This will validate the remote user\u0027s privilege while logging in. \n\u003e \n\u003e I believe the pam authentication does not cover the validation for roles, priv etc for the remote users. Am i missing something here?\n\nYes.  Pam handles authentication, dbus handles authorization.  If a user should not have access then the user itself should be disabled, and that pam check should fail.\n\nIdeally we shouldn\u0027t be using dbus at all for role generation (we previously used only PAM) but a lot of code got stuck in as part of the LDAP work that complicated the design.\n\nIn a perfect world, if we\u0027re going to authenticate/authorize over dbus, we should ONLY be using dbus.  If we\u0027re using pam, we should ONLY be using pam.  We shouldn\u0027t do the pam/dbus hybrid we have now, that\u0027s what leads to bugs like this.",
      "parentUuid": "3767fd46_b02f1381",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5188640b_1d58004d",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-27T05:44:06Z",
      "side": 1,
      "message": "Agree. But this will be a considerable effort in re-designing things.\n\nWhat do you think should be the short-term solution for this from the security point of view? \n\nAny 3rd party No-Access user can create many and many login sessions and exhaust the bmc without logging out. Logout logic checks for the user access, and a No-Access user can not perform logout.",
      "parentUuid": "b9d6a4e3_f051f770",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dd212429_b81a129c",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-27T05:47:59Z",
      "side": 1,
      "message": "\u003e Agree. But this will be a considerable effort in re-designing things.\n\n\u003e \n\u003e What do you think should be the short-term solution for this from the security point of view? \n\u003e \n\nMake sure that phosphor-user-manager properly disables (in linux) no-access users as it should.  bmcweb already checks to see if users are disabled, so if phosphor-user-manager isn\u0027t disabling users set to no-access, then clearly something needs fixed there.\n\n\u003e Any 3rd party No-Access user can create many and many login sessions and exhaust the bmc without logging out. Logout logic checks for the user access, and a No-Access user can not perform logout.\n\n\nNo-access users should  ot be given a session at all.",
      "parentUuid": "5188640b_1d58004d",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "641a9cb8_c6cf0db9",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-28T09:47:37Z",
      "side": 1,
      "message": "\u003e bmcweb already checks to see if users are disabled\n\nCan you please point me to the bmcweb code which checks if the users are disabled at the phosphor-user-manager while creating the session?",
      "parentUuid": "dd212429_b81a129c",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "39e41322_33d927fb",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-28T21:53:03Z",
      "side": 1,
      "message": "Please see the reply on this thread that contains the text \"this is the check to determine if a user is allowed to log in\"  I\u0027ve already pointed you to the code.",
      "parentUuid": "641a9cb8_c6cf0db9",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c349de6_c3e838a6",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000235
      },
      "writtenOn": "2022-01-04T16:06:35Z",
      "side": 1,
      "message": "I see two alternate ways to solve this issue.\n\n1. Change the phosphor-user-manager to disable users who have the \"no access\" role.  In this way, Linux PAM account management checks will determine the user should not be allowed to login  because their account is disabled.  As I mentioned in https://github.com/openbmc/bmcweb/issues/227 I still don\u0027t understand the purpose for the NoAccess role. Is it okay for such users to be \"disabled\".  That doesn\u0027t feel like the right solution to me.\n\n2. Change BMCWeb to add a \"Login\" privilege check as part of its authentication process.  Specifically the proposed design is: if authentication succeeds, then BMCWeb knows the user\u0027s role and can retrieve the user\u0027s Redfish privileges, and check if the user has the \"Login\" privilege.  This solution feels right to me, and I think it is what Sunitha is proposing.",
      "parentUuid": "39e41322_33d927fb",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef24b25b_aaeb9fd3",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-01-06T17:01:03Z",
      "side": 1,
      "message": "I never understood the difference in use case between \"no access\" and \"disabled\".  They seem like synonyms.  #1 would be my preference here, as it keeps business logic out of bmcweb, and ensures that all portions of the system work without having to encode specific role logic in every single user facing daemon.",
      "parentUuid": "3c349de6_c3e838a6",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c84bd2ac_2214fd0a",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000235
      },
      "writtenOn": "2022-01-06T19:01:54Z",
      "side": 1,
      "message": "I don\u0027t fully understand the use case for either a no-access account or a disabled account, and my efforts to answer that question are not yet successful.  IMHO, we should get that answer before proceeding with a fix.  Otherwise:\n1. What is the point of having a disabled account?  What is it used for?\n2. For an enabled account which has the no-access role, I believe BMCWeb should handle it in the same way as any other role.  Specifically, after a successful authentication, I believe PAM account management checks should succeed, and the user\u0027s privileges should be retrieved.  In this case the privileges will be the empty set.  The login operations should then fail.  \u003c-- That is what I proposed in my comment above.  Specifically, the login operation(s) should ensure the user trying to login has the Redfish Login privilege.",
      "parentUuid": "ef24b25b_aaeb9fd3",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2e20334c_2c9636c6",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2022-01-07T10:10:18Z",
      "side": 1,
      "message": "Did changes as per the #2 approach. The first approach can be a long term solution, and need community help in getting that design implemented.",
      "parentUuid": "c84bd2ac_2214fd0a",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7bd2860_92249250",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-01-07T17:58:25Z",
      "side": 1,
      "message": "So is this patch no longer required?",
      "parentUuid": "2e20334c_2c9636c6",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e31beb1b_8edab515",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2022-01-10T04:16:08Z",
      "side": 1,
      "message": "Yes - needed since the current design is to contain the check at bmcweb. The design #2",
      "parentUuid": "a7bd2860_92249250",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a8252d2a_785f35b0",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000020
      },
      "writtenOn": "2022-01-10T14:16:54Z",
      "side": 1,
      "message": "#1 from above would be my preference. \n\n\u003e Did changes as per the #2 approach. The first approach can be a long term solution, and need community help in getting that design implemented.\n\n\u003e Yes - needed since the current design is to contain the check at bmcweb. The design #2\n\nOkay, I still don\u0027t understand why this patch is still needed.? You mentioned this is the current design but sounds like we are in agreement on moving forward with #1? You want this as a short term solution? why? How is this a bad enough bug to merit that?",
      "parentUuid": "e31beb1b_8edab515",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c631316_2a5c785f",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2022-01-10T14:27:28Z",
      "side": 1,
      "message": "At the routing.hpp ; bmcweb relays on the user-manager dbus calls to see if the user at the incoming request is authorized or not using the same logic which i have implemented in this commit. \n\nI am doing this - because, while creating the session, there is no authorization check for the user at the currently available pam library authentication mechanism. As mentioned in the previous discussions, the authentication is with pam library and authorization is with the user-manager app(dbus)\n\nThe #1 solution needs an agreement with the phosphor-user-manager maintainers and a bit more re-design of the authorization checks. This needs more analysis and time. I am not an expert in that areas. Thus i would like to go ahead with this #2, until we have that #1 concluded. We already have this similar check at routing.hpp - so its not a new thing at bmcweb.\n\nI think this commit and the routing.hpp can be re-visited together when the user-manager has the required changes to disable the no-access user and link the pam module to the same.",
      "parentUuid": "a8252d2a_785f35b0",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24ab6efc_d8eeb231",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-01-10T17:11:12Z",
      "side": 1,
      "message": "\u003e Okay, I still don\u0027t understand why this patch is still needed.? \n\n+1\n\n\n\u003e \n\u003e The #1 solution needs an agreement with the phosphor-user-manager maintainers and a bit more re-design of the authorization checks. This needs more analysis and time. I am not an expert in that areas.\n\nHave you engaged with the relevant experts (ie maintainers of phosphor-user-management)?  I don\u0027t see them commenting on this review.  I\u0027ve added them so they can comment.\n\n\n\n\u003e I don\u0027t fully understand the use case for either a no-access account or a disabled account, and my efforts to answer that question are not yet successful.\n\nUser disabled I can understand if you\u0027re an admin that wants to temporarily remove access from a user without blowing away their credentials or something.  What I don\u0027t understand is why you need both user disabled and NoAccess, as they\u0027re essentially synonyms. \nI propose we remove the NoAccess user role, given that it\u0027s redundant to user disabled, and given that this patch exists, has never worked as designed.  That seems simpler than trying to go through complex patches to make something work that\u0027s redundant and has better solutions.",
      "parentUuid": "6c631316_2a5c785f",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ec44b94e_8815d6f9",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000022
      },
      "writtenOn": "2022-01-11T09:41:35Z",
      "side": 1,
      "message": "Priv-Noaccess is coming from IPMI world where user is enabled but no-access, Richard can explain more here.\n\nFollowing commits which were used to add the code related to the priv-noaccess in user-manager and bmcweb.\n \nhttps://github.com/openbmc/bmcweb/commit/e9e6d240ab85e515f8d264e39b47a75043b73374\nhttps://github.com/openbmc/phosphor-user-manager/commit/7c6e7cffaf061aabfe5489ef52442e2f7cbd0fb7\n\n\nEarlier in phosphor-user-manager priv-noaccess was not there and If user has been created with IPMI interface with no privileges that was creating issues for the Redfish where user exists but it\u0027s privileges not exist in Redfish All privileges property.\n\nHence the above two commits were added to support the priv-noaccess.",
      "parentUuid": "24ab6efc_d8eeb231",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a4a8825c_0af2907d",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2022-01-12T03:05:59Z",
      "side": 1,
      "message": "Thanks Ratan, that means that we can not remove this priv. \nRatan/Richard - Please suggest a way user-manager can contain this change as suggested by Ed.",
      "parentUuid": "ec44b94e_8815d6f9",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "761c6f63_f7eec939",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-01-12T03:11:06Z",
      "side": 1,
      "message": "Ratan, can you be more specific?  section 6.8 of IPMI shows Callback, User, Operator, and Administrator privilege level.  There is no \"no access\" privilege that I\u0027m seeing. Can you please point to where in the spec you\u0027re looking?\n\n\n\n\u003e Earlier in phosphor-user-manager priv-noaccess was not there and If user has been created with IPMI interface with no privileges that was creating issues for the Redfish where user exists but it\u0027s privileges not exist in Redfish All privileges property.\n\nI\u0027m not understanding why that would be an issue.  A user that has no role should be given no privileges.  This change arguably caused the bug that Sunitha is trying to fix in this patch.\n\n\nI\u0027m still of the opinion that this is a phosphor-user-manager bug.  NoAccess users should not be able to pass a PAM authentication check, which is checking for whether they have access.  Ratan, can you please speak to that point?",
      "parentUuid": "a4a8825c_0af2907d",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a7177276_e768ee3d",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000022
      },
      "writtenOn": "2022-01-12T06:37:33Z",
      "side": 1,
      "message": "\u003e Ratan, can you be more specific?  section 6.8 of IPMI shows Callback, User, Operator, and Administrator privilege level.  There is no \"no access\" privilege that I\u0027m seeing. Can you please point to where in the spec you\u0027re looking?\n\nI will let Richard to reply on the same, whether the IPMI callback is mapped to priv-noaccess.\n\n\u003e Earlier in phosphor-user-manager priv-noaccess was not there and If user has been created with IPMI interface with no privileges that was creating issues for the Redfish where user exists but it\u0027s privileges not exist in Redfish All privileges property.\n\nI\u0027m not understanding why that would be an issue.  A user that has no role should be given no privileges.  This change arguably caused the bug that Sunitha is trying to fix in this patch.\n\n\nOn Redfish, User exist but with no privilege. Are you saying that is/was not an issue wrt Redfish?\n\n\u003e I\u0027m still of the opinion that this is a phosphor-user-manager bug.  NoAccess users should not be able to pass a PAM authentication check, which is checking for whether they have access.  Ratan, can you please speak to that point?\n\nWhat is the phopshor-user-manager bug here? Pam authentication is not going through phosphor-user-manager.\n\nAre you saying that we should introduce a new pam module which should check for the role of the user and allow the pam module(pam_unix.so) to be proceed further if the role is !\u003d no access.\n\nCurrently following is the pam configuration file for the bmcweb(supplied by the bmcweb)\n\nhttps://github.com/openbmc/bmcweb/blob/master/pam-webserver\n\n#%PAM-1.0\n\nauth     include  common-auth\n# skip redfish group check for non-local user (ldap)\nauth     [success\u003dok perm_denied\u003d1 default\u003dignore] pam_localuser.so\nauth     required pam_succeed_if.so user ingroup redfish\naccount  include  common-account\npassword include  common-password\n\nAs per the above configuration file we are not adding any custom pam module here.\n\nAre you proposing that we should introduce a new pam module and all the callers pam configuration file will add that module in their configuration so during pam_authentication check it will fail for those users which have the no access role.",
      "parentUuid": "761c6f63_f7eec939",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "64796002_c99fae83",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-01-12T20:32:29Z",
      "side": 1,
      "message": "\u003e \u003e Ratan, can you be more specific?  section 6.8 of IPMI shows Callback, User, Operator, and Administrator privilege level.  There is no \"no access\" privilege that I\u0027m seeing. Can you please point to where in the spec you\u0027re looking?\n\u003e \n\u003e I will let Richard to reply on the same, whether the IPMI callback is mapped to priv-noaccess.\n\nLooking forward to him jumping on this thread.\n\n\u003e \n\u003e \u003e Earlier in phosphor-user-manager priv-noaccess was not there and If user has been created with IPMI interface with no privileges that was creating issues for the Redfish where user exists but it\u0027s privileges not exist in Redfish All privileges property.\n\u003e \n\u003e I\u0027m not understanding why that would be an issue.  A user that has no role should be given no privileges.  This change arguably caused the bug that Sunitha is trying to fix in this patch.\n\nThe problem becomes that a user is given no privileges, but is still able to log in, which causes a bug where they\u0027re not able to log out, because they have no privileges.  IMO, NoAccess users should not be allowed to log in at all.\n\n\u003e \n\u003e \n\u003e On Redfish, User exist but with no privilege. Are you saying that is/was not an issue wrt Redfish?\n\nI\u0027m saying this was an issue that was created when the \"NoAccess\" privilege level was added, outside of what the defaults in redfish promote.\n\n\u003e \n\u003e \u003e I\u0027m still of the opinion that this is a phosphor-user-manager bug.  NoAccess users should not be able to pass a PAM authentication check, which is checking for whether they have access.  Ratan, can you please speak to that point?\n\u003e \n\u003e What is the phopshor-user-manager bug here? Pam authentication is not going through phosphor-user-manager.\n\nNo, but it\u0027s going through the user database, which phosphor-user-manager controls.  The bug is that phosphor-user-manager is not disabling NoAccess users accounts, so they can still log in.\n\n\u003e \n\u003e Are you saying that we should introduce a new pam module which should check for the role of the user and allow the pam module(pam_unix.so) to be proceed further if the role is !\u003d no access.\n\nNo.  The users account should be disabled or locked in linux.\n\n\u003e \n\u003e Currently following is the pam configuration file for the bmcweb(supplied by the bmcweb)\n\u003e \n\u003e https://github.com/openbmc/bmcweb/blob/master/pam-webserver\n\u003e \n\u003e #%PAM-1.0\n\u003e \n\u003e auth     include  common-auth\n\u003e # skip redfish group check for non-local user (ldap)\n\u003e auth     [success\u003dok perm_denied\u003d1 default\u003dignore] pam_localuser.so\n\u003e auth     required pam_succeed_if.so user ingroup redfish\n\u003e account  include  common-account\n\u003e password include  common-password\n\u003e \n\u003e As per the above configuration file we are not adding any custom pam module here.\n\u003e \n\ncommon-account and common-password (which are included above) are provided by the greater project, and provide custom pam modules, including some from phosphor-user-manager.  See the meta-phosphor layer for more details on them.  With that said, this file only gets invoked for pam_authenticate, not for checking the health of the user account that I posted earlier in this thread.\n\n\u003e Are you proposing that we should introduce a new pam module and all the callers pam configuration file will add that module in their configuration so during pam_authentication check it will fail for those users which have the no access role.\n\nNo, I\u0027m proposing that users that are given a \"NoAccess\" role should be disabled, such that the pam health check that I linked above fails.  This should just require phosphor-user-manager to properly adjust the users enabled-ness.",
      "parentUuid": "a7177276_e768ee3d",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4659b81_6ff809ef",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000022
      },
      "writtenOn": "2022-01-13T09:55:15Z",
      "side": 1,
      "message": "\u003e The problem becomes that a user is given no privileges, but is still able to log in, which causes a bug where they\u0027re not able to log out, because they have no privileges.  IMO, NoAccess users should not be allowed to log in at all.\n\nWhy do we need such user which is not having any privilege, Why to create a user that all?\nIf somebody is creating a user with no privilege and user manager makes that user disable that doesn\u0027t make sense(it is of no use), Instead of we should not allow that user to be created.\n\nBut seems we need to understand from the IPMI perspective too, why do we need such user?",
      "parentUuid": "64796002_c99fae83",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "59e324bb_ac69a459",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-01-13T20:52:05Z",
      "side": 1,
      "message": "\u003e \u003e The problem becomes that a user is given no privileges, but is still able to log in, which causes a bug where they\u0027re not able to log out, because they have no privileges.  IMO, NoAccess users should not be allowed to log in at all.\n\u003e \n\u003e Why do we need such user which is not having any privilege, Why to create a user that all?\n\nI asked this question earlier when I asked why NoAccess is distinct from disabled.  There is an enterprise case for disabling someones access temporarily, given that user passwords are hashed on the device, you generally can\u0027t destroy and create a user losslessly, so instead there\u0027s a way to disable a given user for a period of time without destroying their credentials.\n\n\u003e If somebody is creating a user with no privilege and user manager makes that user disable that doesn\u0027t make sense(it is of no use), Instead of we should not allow that user to be created.\n\nThat would be fine too if we just want to disallow NoAccess users from existing.\n\n\u003e \n\u003e But seems we need to understand from the IPMI perspective too, why do we need such user?\n\n+1",
      "parentUuid": "e4659b81_6ff809ef",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c209686d_fa0d97a6",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000219
      },
      "writtenOn": "2022-01-18T16:29:33Z",
      "side": 1,
      "message": "It seems to me the IPMI spec was wrongly interpreted. `NO ACCESS` says that the user has no access to the specified channel, but doesn\u0027t describe his global privilege.\n\nMy proposal (likely Offtopic for this PR):\n- `no-access` role should be removed from BMC at all.\n   There is the users disabling, that already properly works even through IPMI.\n- Default minimal privilege in the BMC should be `read-only`.\n  It solves the issue for LDAP users which ones are not members of groups mapped to BMC roles.\n- Users that really shouldn\u0027t have access to the BMC can be just disabled.",
      "parentUuid": "59e324bb_ac69a459",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a405b398_b6eb1948",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2022-01-31T11:17:33Z",
      "side": 1,
      "message": "Thanks Alex for sharing your thoughts. \n\nShould the support for no-access user be removed from the bmcweb ? Meaning revert these 2 commits https://github.com/openbmc/bmcweb/commit/e9e6d240ab85e515f8d264e39b47a75043b73374\nhttps://github.com/openbmc/phosphor-user-manager/commit/7c6e7cffaf061aabfe5489ef52442e2f7cbd0fb7\n\nI am a bit clueless here as how to proceed.",
      "parentUuid": "c209686d_fa0d97a6",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "22fdb394_a2269aa6",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000219
      },
      "writtenOn": "2022-01-31T14:30:29Z",
      "side": 1,
      "message": "I suppose those two commits should definitely be reverted, but I suspect there are more places where the support for no-access should be removed.\n\nI guess `phosphor-host-ipmi` also requires some reworking to make it properly handling the command like `ipmitool user priv \u003cuser-id\u003e 0xF [channel-id]`.\nAnd I see here two possible ways:\n - reject this request with the correct completion code. For example 0xC9 (Param is out of range).\n - rework the code to set the correct permissions for the current or specified IPMI channel without modifying the user\u0027s global role.\n \nLDAP users can still have no valid roles and this should be properly handled.\nAs one of the possible solutions is using `priv-user` instead of undefined role.\nBut most likely it would be more correct and securely to filter the such users at the PAM level, as it proposed Ed.",
      "parentUuid": "a405b398_b6eb1948",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "322074ea_6779d8ab",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000219
      },
      "writtenOn": "2022-02-01T12:57:01Z",
      "side": 1,
      "message": "I\u0027ve pushed the proposed changes for phosphor-host-ipmid:\n  https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-host-ipmid/+/50824\n  https://gerrit.openbmc-project.xyz/c/openbmc/phosphor-host-ipmid/+/50825",
      "parentUuid": "22fdb394_a2269aa6",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "726ec191_7c0daf02",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2022-02-02T05:11:44Z",
      "side": 1,
      "message": "Ed \u0026 Ratan, any thoughts ?",
      "parentUuid": "322074ea_6779d8ab",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1e331901_4c6811b6",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000022
      },
      "writtenOn": "2022-02-16T16:49:10Z",
      "side": 1,
      "message": "Sunitha, I don\u0027t see any activity on the phospho-host-ipmid commits, If those patches gets in, Then you can remove the support of priv access from the user-manager and you need to make the necessary changes in the bmcweb too.\n\nEd, is that fine to you too?",
      "parentUuid": "726ec191_7c0daf02",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6205595a_69c6b93f",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-02-16T23:46:46Z",
      "side": 1,
      "message": "Removing no-access entirely from bmcweb is I think what I proposed elsewhere, and based on the above discussion, yes, is what I think we should do.",
      "parentUuid": "1e331901_4c6811b6",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "830d787c_3154ca5c",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2022-02-17T04:19:20Z",
      "side": 1,
      "message": "Excellent! Thank you\nLets wait for the phosphor-host-ipmid commits to get merged, and then I can revert the bmcweb commits which added the no access user to bmcweb scope.",
      "parentUuid": "6205595a_69c6b93f",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2477c364_d68066e9",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000219
      },
      "writtenOn": "2022-03-09T08:47:48Z",
      "side": 1,
      "message": "\u003e Lets wait for the phosphor-host-ipmid commits to get merged, and then I can revert the bmcweb commits which added the no access user to bmcweb scope.\n\nI guess it\u0027s time. ;)\nCould you push these pull-requests with a topic `remove-priv-noaccess`?\nI guess it will improve understanding of our intentions.",
      "parentUuid": "830d787c_3154ca5c",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}