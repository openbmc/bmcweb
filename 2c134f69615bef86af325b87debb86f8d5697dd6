{
  "comments": [
    {
      "key": {
        "uuid": "f5ff2ccb_91799a83",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-05T19:58:58Z",
      "side": 1,
      "message": "This kind of business logic should not be in bmcweb.  If users with no-access shouldn\u0027t be allowed to log in, then they should be rejected by PAM/phosphor-user-manager.",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "defd93cc_2e6f064c",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-05T20:01:19Z",
      "side": 1,
      "message": "To be more concrete, this is the check to determine if a user is allowed to log in, using the standard pam mechanisms.\n\nhttps://github.com/openbmc/bmcweb/blob/889ff6943d62762eeaf58824b651d2edaf940d1d/include/pam_authenticate.hpp#L98\n\nIf this is succeeding for NoAccess users that means that phosphor-user-manager has failed its API guarantees, and hasn\u0027t disabled the user properly.",
      "parentUuid": "f5ff2ccb_91799a83",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "52c11756_2e642cdb",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-06T04:22:07Z",
      "side": 1,
      "message": "Yes Ed. I was also checking in the same lines after pushing the commit. I will check and see how to handle this at the user manager and will update here",
      "parentUuid": "defd93cc_2e6f064c",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3767fd46_b02f1381",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-06T10:38:09Z",
      "side": 1,
      "message": "I made these changes to get the https://github.com/openbmc/bmcweb/blob/master/http/routing.hpp#L1415 logic applied when the redfish session is getting created. This will validate the remote user\u0027s privilege while logging in. \n\nI believe the pam authentication does not cover the validation for roles, priv etc for the remote users. Am i missing something here?",
      "parentUuid": "52c11756_2e642cdb",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b9d6a4e3_f051f770",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-06T19:17:56Z",
      "side": 1,
      "message": "\u003e I made these changes to get the https://github.com/openbmc/bmcweb/blob/master/http/routing.hpp#L1415 logic applied when the redfish session is getting created. This will validate the remote user\u0027s privilege while logging in. \n\u003e \n\u003e I believe the pam authentication does not cover the validation for roles, priv etc for the remote users. Am i missing something here?\n\nYes.  Pam handles authentication, dbus handles authorization.  If a user should not have access then the user itself should be disabled, and that pam check should fail.\n\nIdeally we shouldn\u0027t be using dbus at all for role generation (we previously used only PAM) but a lot of code got stuck in as part of the LDAP work that complicated the design.\n\nIn a perfect world, if we\u0027re going to authenticate/authorize over dbus, we should ONLY be using dbus.  If we\u0027re using pam, we should ONLY be using pam.  We shouldn\u0027t do the pam/dbus hybrid we have now, that\u0027s what leads to bugs like this.",
      "parentUuid": "3767fd46_b02f1381",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5188640b_1d58004d",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-27T05:44:06Z",
      "side": 1,
      "message": "Agree. But this will be a considerable effort in re-designing things.\n\nWhat do you think should be the short-term solution for this from the security point of view? \n\nAny 3rd party No-Access user can create many and many login sessions and exhaust the bmc without logging out. Logout logic checks for the user access, and a No-Access user can not perform logout.",
      "parentUuid": "b9d6a4e3_f051f770",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dd212429_b81a129c",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-27T05:47:59Z",
      "side": 1,
      "message": "\u003e Agree. But this will be a considerable effort in re-designing things.\n\n\u003e \n\u003e What do you think should be the short-term solution for this from the security point of view? \n\u003e \n\nMake sure that phosphor-user-manager properly disables (in linux) no-access users as it should.  bmcweb already checks to see if users are disabled, so if phosphor-user-manager isn\u0027t disabling users set to no-access, then clearly something needs fixed there.\n\n\u003e Any 3rd party No-Access user can create many and many login sessions and exhaust the bmc without logging out. Logout logic checks for the user access, and a No-Access user can not perform logout.\n\n\nNo-access users should  ot be given a session at all.",
      "parentUuid": "5188640b_1d58004d",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "641a9cb8_c6cf0db9",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-28T09:47:37Z",
      "side": 1,
      "message": "\u003e bmcweb already checks to see if users are disabled\n\nCan you please point me to the bmcweb code which checks if the users are disabled at the phosphor-user-manager while creating the session?",
      "parentUuid": "dd212429_b81a129c",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4",
      "unresolved": true
    }
  ]
}