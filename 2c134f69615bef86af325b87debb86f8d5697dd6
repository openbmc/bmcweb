{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "c12febe4_49bbd5d0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000235
      },
      "writtenOn": "2022-01-04T16:06:35Z",
      "side": 1,
      "message": "I think BMCWeb should check if the user trying to log in has the \"Login\" privilege.",
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d6aa1a02_cfb8134d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1000235
      },
      "writtenOn": "2022-01-06T19:01:54Z",
      "side": 1,
      "message": "Regardless of if we have disabled user accounts, I think BMCWeb login operations should be enhanced so they only allow the login operation to succeed if the user trying to login has the Redfish Login privilege.",
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d587922e_841cd079",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 230,
      "author": {
        "id": 1000235
      },
      "writtenOn": "2022-01-04T16:06:35Z",
      "side": 1,
      "message": "Per my proposed design (see notes below), this line of code should be changed to:\nUse the user\u0027s role to retrieve the set of Privileges, then check if the \"Login\" privelege is present.   If so then proceed, otherwise error out with \"accessDenied\".",
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f5ff2ccb_91799a83",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-05T19:58:58Z",
      "side": 1,
      "message": "This kind of business logic should not be in bmcweb.  If users with no-access shouldn\u0027t be allowed to log in, then they should be rejected by PAM/phosphor-user-manager.",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "defd93cc_2e6f064c",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-05T20:01:19Z",
      "side": 1,
      "message": "To be more concrete, this is the check to determine if a user is allowed to log in, using the standard pam mechanisms.\n\nhttps://github.com/openbmc/bmcweb/blob/889ff6943d62762eeaf58824b651d2edaf940d1d/include/pam_authenticate.hpp#L98\n\nIf this is succeeding for NoAccess users that means that phosphor-user-manager has failed its API guarantees, and hasn\u0027t disabled the user properly.",
      "parentUuid": "f5ff2ccb_91799a83",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "52c11756_2e642cdb",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-06T04:22:07Z",
      "side": 1,
      "message": "Yes Ed. I was also checking in the same lines after pushing the commit. I will check and see how to handle this at the user manager and will update here",
      "parentUuid": "defd93cc_2e6f064c",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3767fd46_b02f1381",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-06T10:38:09Z",
      "side": 1,
      "message": "I made these changes to get the https://github.com/openbmc/bmcweb/blob/master/http/routing.hpp#L1415 logic applied when the redfish session is getting created. This will validate the remote user\u0027s privilege while logging in. \n\nI believe the pam authentication does not cover the validation for roles, priv etc for the remote users. Am i missing something here?",
      "parentUuid": "52c11756_2e642cdb",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b9d6a4e3_f051f770",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-06T19:17:56Z",
      "side": 1,
      "message": "\u003e I made these changes to get the https://github.com/openbmc/bmcweb/blob/master/http/routing.hpp#L1415 logic applied when the redfish session is getting created. This will validate the remote user\u0027s privilege while logging in. \n\u003e \n\u003e I believe the pam authentication does not cover the validation for roles, priv etc for the remote users. Am i missing something here?\n\nYes.  Pam handles authentication, dbus handles authorization.  If a user should not have access then the user itself should be disabled, and that pam check should fail.\n\nIdeally we shouldn\u0027t be using dbus at all for role generation (we previously used only PAM) but a lot of code got stuck in as part of the LDAP work that complicated the design.\n\nIn a perfect world, if we\u0027re going to authenticate/authorize over dbus, we should ONLY be using dbus.  If we\u0027re using pam, we should ONLY be using pam.  We shouldn\u0027t do the pam/dbus hybrid we have now, that\u0027s what leads to bugs like this.",
      "parentUuid": "3767fd46_b02f1381",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5188640b_1d58004d",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-27T05:44:06Z",
      "side": 1,
      "message": "Agree. But this will be a considerable effort in re-designing things.\n\nWhat do you think should be the short-term solution for this from the security point of view? \n\nAny 3rd party No-Access user can create many and many login sessions and exhaust the bmc without logging out. Logout logic checks for the user access, and a No-Access user can not perform logout.",
      "parentUuid": "b9d6a4e3_f051f770",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dd212429_b81a129c",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-27T05:47:59Z",
      "side": 1,
      "message": "\u003e Agree. But this will be a considerable effort in re-designing things.\n\n\u003e \n\u003e What do you think should be the short-term solution for this from the security point of view? \n\u003e \n\nMake sure that phosphor-user-manager properly disables (in linux) no-access users as it should.  bmcweb already checks to see if users are disabled, so if phosphor-user-manager isn\u0027t disabling users set to no-access, then clearly something needs fixed there.\n\n\u003e Any 3rd party No-Access user can create many and many login sessions and exhaust the bmc without logging out. Logout logic checks for the user access, and a No-Access user can not perform logout.\n\n\nNo-access users should  ot be given a session at all.",
      "parentUuid": "5188640b_1d58004d",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "641a9cb8_c6cf0db9",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000382
      },
      "writtenOn": "2021-12-28T09:47:37Z",
      "side": 1,
      "message": "\u003e bmcweb already checks to see if users are disabled\n\nCan you please point me to the bmcweb code which checks if the users are disabled at the phosphor-user-manager while creating the session?",
      "parentUuid": "dd212429_b81a129c",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "39e41322_33d927fb",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-28T21:53:03Z",
      "side": 1,
      "message": "Please see the reply on this thread that contains the text \"this is the check to determine if a user is allowed to log in\"  I\u0027ve already pointed you to the code.",
      "parentUuid": "641a9cb8_c6cf0db9",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3c349de6_c3e838a6",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000235
      },
      "writtenOn": "2022-01-04T16:06:35Z",
      "side": 1,
      "message": "I see two alternate ways to solve this issue.\n\n1. Change the phosphor-user-manager to disable users who have the \"no access\" role.  In this way, Linux PAM account management checks will determine the user should not be allowed to login  because their account is disabled.  As I mentioned in https://github.com/openbmc/bmcweb/issues/227 I still don\u0027t understand the purpose for the NoAccess role. Is it okay for such users to be \"disabled\".  That doesn\u0027t feel like the right solution to me.\n\n2. Change BMCWeb to add a \"Login\" privilege check as part of its authentication process.  Specifically the proposed design is: if authentication succeeds, then BMCWeb knows the user\u0027s role and can retrieve the user\u0027s Redfish privileges, and check if the user has the \"Login\" privilege.  This solution feels right to me, and I think it is what Sunitha is proposing.",
      "parentUuid": "39e41322_33d927fb",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ef24b25b_aaeb9fd3",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2022-01-06T17:01:03Z",
      "side": 1,
      "message": "I never understood the difference in use case between \"no access\" and \"disabled\".  They seem like synonyms.  #1 would be my preference here, as it keeps business logic out of bmcweb, and ensures that all portions of the system work without having to encode specific role logic in every single user facing daemon.",
      "parentUuid": "3c349de6_c3e838a6",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c84bd2ac_2214fd0a",
        "filename": "redfish-core/lib/redfish_sessions.hpp",
        "patchSetId": 1
      },
      "lineNbr": 266,
      "author": {
        "id": 1000235
      },
      "writtenOn": "2022-01-06T19:01:54Z",
      "side": 1,
      "message": "I don\u0027t fully understand the use case for either a no-access account or a disabled account, and my efforts to answer that question are not yet successful.  IMHO, we should get that answer before proceeding with a fix.  Otherwise:\n1. What is the point of having a disabled account?  What is it used for?\n2. For an enabled account which has the no-access role, I believe BMCWeb should handle it in the same way as any other role.  Specifically, after a successful authentication, I believe PAM account management checks should succeed, and the user\u0027s privileges should be retrieved.  In this case the privileges will be the empty set.  The login operations should then fail.  \u003c-- That is what I proposed in my comment above.  Specifically, the login operation(s) should ensure the user trying to login has the Redfish Login privilege.",
      "parentUuid": "ef24b25b_aaeb9fd3",
      "range": {
        "startLine": 199,
        "startChar": 0,
        "endLine": 266,
        "endChar": 37
      },
      "revId": "2c134f69615bef86af325b87debb86f8d5697dd6",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}